<!DOCTYPE html>

<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>WeCut</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --nav-height: 64px;
        }

        /* Modal fullscreen no mobile */
        @media (max-width: 768px) {
            #professional-details-modal {
                padding: 0 !important;
                margin: 0 !important;
            }

            #professional-details-modal>div {
                width: 100vw !important;
                height: 100vh !important;
                max-height: 100vh !important;
                max-width: 100vw !important;
                margin: 0 !important;
                border-radius: 0 !important;
                padding: 16px !important;
            }
        }

        nav.v27-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            height: var(--nav-height);
            background: #fff;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 50;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            padding: 0.5rem 1rem;
        }

        body {
            padding-top: var(--nav-height);
        }

        .v27-container {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            gap: 1rem;
        }

        .v27-logo {
            flex: 0 0 auto;
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: .5rem;
        }

        .v27-center {
            flex: 1 1 auto;
            display: flex;
            justify-content: center;
            gap: 1.25rem;
        }

        .v27-auth {
            flex: 0 0 auto;
            margin-left: auto;
            display: flex;
            gap: .5rem;
            align-items: center;
        }

        .v27-auth button {
            white-space: nowrap;
        }

        #v27-mobile-btn {
            display: none;
        }

        @media(max-width:768px) {
            .v27-center {
                display: none;
            }

            #v27-mobile-btn {
                display: block;
            }

            .v27-auth {
                order: 2;
                margin-left: 0;
                margin-right: .5rem;
            }

            .v27-logo {
                order: 1;
            }

            #v27-mobile-btn {
                order: 3;
            }
        }

        .wecut-button-hover {
            transition: all .15s ease;
        }

        .wecut-button-hover:hover {
            transform: translateY(-1px);
        }


        /* === CORREÇÃO DEFINITIVA PARA OS CARDS NO PAINEL PROFISSIONAL === */
        .professional-layout {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
            position: relative;
        }

        .professional-main-content {
            flex: 1;
            min-width: 0;
            /* Importante para flexbox */
        }

        .professional-sidebar {
            width: 100%;
            max-width: 320px;
            position: sticky;
            top: 100px;
            /* Mais espaço da navbar */
            align-self: flex-start;
            height: fit-content;
        }

        .professional-sidebar>div {
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 10;
        }

        /* Garantir que o container pai tenha altura suficiente */
        .professional-layout-container {
            min-height: 600px;
        }

        /* Ajuste responsivo */
        @media (max-width: 1024px) {
            .professional-layout {
                flex-direction: column;
            }

            .professional-sidebar {
                position: static;
                max-width: 100%;
                order: -1;
                /* Coloca a sidebar antes do conteúdo em mobile */
            }
        }

        /* Correção específica para os cards: REMOVIDA a propriedade 'position: sticky' dos cards internos.
     Isso garante que eles fiquem estáticos (empilhados normalmente) dentro da sidebar 'sticky', 
     evitando sobreposição. */
        .sticky-sidebar-card {
            transition: all 0.3s ease;
            z-index: 40;
        }

        .sticky-sidebar-card+.sticky-sidebar-card {
            /* Nenhuma regra de posição explícita para o segundo card, permitindo empilhamento normal. */
        }

        /* === FIM DA CORREÇÃO === */

        /* === AJUSTES DE RESPONSIVIDADE E ESPAÇAMENTO === */

        /* Garantir que inputs longos não saiam da tela */
        #professional-edit-form input[type="text"],
        #professional-edit-form input[type="number"],
        #professional-edit-form input[type="time"],
        #professional-edit-form input[type="tel"],
        #professional-edit-form textarea {
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Ajustar disposição dos campos de serviço e preço em telas pequenas */
        @media (max-width: 768px) {
            #services-list>div {
                flex-direction: column;
                align-items: stretch;
            }

            #services-list input[name="service-price"] {
                width: 100%;
            }

            #services-list button {
                align-self: flex-end;
            }
        }

        /* Garantir espaçamento consistente e evitar overflow no painel profissional */
        .professional-layout,
        #professional-edit-form,
        #professional-view-profile-page {
            overflow-x: hidden;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* Ajustar grid e seções para telas menores */
        @media (max-width: 1024px) {

            .grid-cols-2,
            .md\:grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Evitar que botões e campos fiquem colados */
        #professional-edit-form .flex,
        #professional-edit-form .grid {
            gap: 0.75rem;
        }

        /* Ajuste para imagens do salão */
        @media (max-width: 640px) {

            .grid-cols-3,
            .md\:grid-cols-3 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Evitar estouro horizontal em cards e formulários */
        body,
        html {
            overflow-x: hidden;
        }

        /* === CORREÇÃO FINAL: seção do painel profissional ocupa toda a tela === */
        .professional-layout-container,
        #page-container,
        #professional-dashboard-page,
        #professional-view-profile-page,
        #professional-edit-profile-page {
            min-height: calc(100vh - var(--nav-height));
            padding-top: var(--nav-height);
            box-sizing: border-box;
        }

        /* Garante que não haja espaço morto no topo */
        body {
            margin: 0;
            padding: 0;
        }

        /* Em telas pequenas, assegura que o painel use a largura total */
        @media (max-width: 768px) {

            .professional-layout,
            #page-container {
                width: 100%;
                max-width: 100%;
            }
        }

        /* === BOTÕES PROFISSIONAIS — CORREÇÃO COMPLETA DE RESPONSIVIDADE === */
        .professional-buttons-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
        }

        .professional-buttons-group button {
            flex: 1 1 auto;
            min-width: 120px;
            max-width: 100%;
        }

        /* Telas muito pequenas (Samsung S8+, Itel A60s, etc.) */
        @media (max-width: 430px) {
            .professional-buttons-group {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .professional-buttons-group button {
                width: 100% !important;
                font-size: 0.9rem;
                padding: 0.6rem 0.8rem;
            }

            /* Ajuste global de cards e grids */
            .card,
            .dashboard-section,
            .report-card,
            .table-responsive {
                width: 100% !important;
                margin: 0 auto !important;
                padding: 0.75rem !important;
            }

            .grid,
            .report-grid {
                grid-template-columns: 1fr !important;
            }

            h2,
            h3,
            .section-title {
                font-size: 1.1rem !important;
                text-align: center;
            }
        }

        /* Animações para o toast de sucesso */
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }

            to {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <nav class="v27-nav" id="navigation">
        <div class="v27-container">
            <div class="v27-logo cursor-pointer" id="logo">
                <h1 class="text-2xl font-medium text-black">WeCut</h1>
            </div>
            <div class="v27-center hidden md:flex" id="desktop-nav">
                <div class="flex items-center gap-2" id="client-nav">
                    <button
                        class="px-3 py-2 rounded-md text-sm font-medium text-black hover:bg-gray-50 wecut-button-hover nav-link"
                        data-view="home-page">Início</button>
                    <button
                        class="px-3 py-2 rounded-md text-sm font-medium text-black hover:bg-gray-50 wecut-button-hover nav-link"
                        data-view="search-page">Buscar</button>
                    <button
                        class="px-3 py-2 rounded-md text-sm font-medium text-black hover:bg-gray-50 wecut-button-hover nav-link"
                        data-view="appointments-page">Agendamentos</button>
                </div>
            </div>
            <div class="v27-auth items-center">
                <div class="hidden flex items-center gap-2" id="auth-buttons">
                    <button class="px-4 py-2 text-sm text-black hover:bg-gray-50 rounded-md wecut-button-hover"
                        id="login-btn">Entrar</button>
                    <button
                        class="px-4 py-2 text-sm bg-black text-white hover:bg-gray-800 rounded-md wecut-button-hover"
                        id="signup-btn">Cadastrar</button>
                </div>
                <div class="hidden flex items-center gap-2" id="user-menu">
                    <button
                        class="flex items-center gap-2 px-3 py-2 text-sm text-black hover:bg-gray-50 rounded-md wecut-button-hover"
                        id="user-profile-btn">
                        <i class="w-4 h-4" data-lucide="user"></i>
                        <span id="user-name">Usuário</span>
                    </button>
                    <button class="px-3 py-2 text-sm text-black hover:bg-gray-50 rounded-md wecut-button-hover"
                        id="logout-btn">Sair</button>
                </div>
                <button aria-label="Abrir menu" class="md:hidden text-black hover:bg-gray-50 p-2 rounded-md"
                    id="v27-mobile-btn">
                    <i class="w-5 h-5" data-lucide="menu"></i>
                </button>
            </div>
        </div>
    </nav>
    <script>

        // === Lista de províncias de Moçambique ===
        const MOZAMBIQUE_PROVINCES = [
            "Cabo Delgado",
            "Gaza",
            "Inhambane",
            "Manica",
            "Maputo (Cidade)",
            "Maputo (Província)",
            "Nampula",
            "Niassa",
            "Sofala",
            "Tete",
            "Zambézia"
        ];

        // Estado de autenticação - substitua pela sua lógica real do Firebase
        let isAuthenticated = false;

        // Função para verificar autenticação (substitua pela lógica real do Firebase)
        function checkAuthState() {
            // Simulação da verificação do Firebase
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Aqui você implementaria a verificação real do Firebase
                    // firebase.auth().onAuthStateChanged((user) => { ... })

                    // Para demonstração, vamos usar um estado fixo
                    // Altere para true para ver o menu do usuário
                    isAuthenticated = false;

                    resolve();
                }, 100);
            });
        }

        // NOVO: Função auxiliar para verificar se é a data de hoje
        function isToday(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            return date.getDate() === today.getDate() &&
                date.getMonth() === today.getMonth() &&
                date.getFullYear() === today.getFullYear();
        }

        // NOVO: Função auxiliar para converter preço
        function parsePrice(priceString) {
            // Ex: '45,00 MT' -> 45.00
            const numberString = priceString.replace(' MT', '').replace(',', '.');
            return parseFloat(numberString);
        }

        // NOVO: Função para calcular métricas do profissional
        function getProfessionalMetrics(professionalId) {
            const professional = stateManager.state.professionals.find(p => p.id === professionalId);
            const professionalAppointments = stateManager.getProfessionalAppointments(professionalId);

            // 1. CÁLCULO DE FINALIZADOS (Substitui "Avaliação Média")
            const totalFinished = professionalAppointments.filter(apt => apt.status === 'completed').length;

            // 2. CÁLCULO DE TOTAL GANHO (Hoje)
            const todayAppointments = professionalAppointments.filter(apt =>
                apt.status === 'completed' && isToday(apt.date)
            );

            const totalGanhoHoje = todayAppointments.reduce((total, apt) => {
                return total + parsePrice(apt.price);
            }, 0);

            const totalGanhoHojeFormatado = totalGanhoHoje.toFixed(2).replace('.', ',') + ' MT';

            return `
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
            <div class="text-center p-3 bg-gray-50 rounded-lg border border-gray-100">
                <p class="text-2xl font-bold text-gray-900">${professionalAppointments.length}</p>
                <p class="text-sm text-gray-600">Total de Agendamentos</p>
            </div>
            <div class="text-center p-3 bg-gray-50 rounded-lg border border-gray-100">
                <p class="text-2xl font-bold text-gray-900">${totalFinished}</p>
                <p class="text-sm text-gray-600">Finalizados</p>
            </div>
            <div class="text-center p-3 bg-gray-50 rounded-lg border border-gray-100">
                <p class="text-2xl font-bold text-gray-900">${totalGanhoHojeFormatado}</p>
                <p class="text-sm text-gray-600">Total Ganho (Hoje)</p>
            </div>
        </div>
    `;
        }

        // Função para atualizar a UI baseada no estado de autenticação
        function updateAuthUI() {
            const authButtons = document.getElementById('auth-buttons');
            const userMenu = document.getElementById('user-menu');

            if (isAuthenticated) {
                authButtons.classList.add('hidden');
                userMenu.classList.remove('hidden');
            } else {
                authButtons.classList.remove('hidden');
                userMenu.classList.add('hidden');
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', async () => {
            // Inicializar ícones
            if (window.lucide && typeof lucide.createIcons === 'function') lucide.createIcons();

            // Verificar estado de autenticação
            await checkAuthState();

            // Atualizar UI após verificação
            updateAuthUI();

            // **NOVO: Verificar se há link de perfil na URL**
            checkProfileLinkOnLoad();

            // Event listeners para os botões de autenticação
            document.getElementById('login-btn')?.addEventListener('click', () => {
                renderView('login-page');
            });

            document.getElementById('signup-btn')?.addEventListener('click', () => {
                renderView('login-page');
                setTimeout(() => {
                    showRegisterForm();
                }, 100);
            });

            document.getElementById('logout-btn')?.addEventListener('click', () => {
                handleLogout();
            });
        });

        // Event listeners para os botões de autenticação
        document.getElementById('login-btn')?.addEventListener('click', () => {
            // Implementar lógica de login
            console.log('Login clicado');
        });

        document.getElementById('signup-btn')?.addEventListener('click', () => {
            // Implementar lógica de cadastro
            console.log('Cadastrar clicado');
        });

        document.getElementById('logout-btn')?.addEventListener('click', () => {
            // Implementar lógica de logout
            isAuthenticated = false;
            updateAuthUI();
        });

        // Função para gerar link único do profissional
        function generateProfileLink(professionalId) {
            const baseUrl = window.location.origin + window.location.pathname;
            return `${baseUrl}?profile=${professionalId}`;
        }

        // Função para copiar link para área de transferência
        async function shareProfileLink(professionalId) {
            const professional = stateManager.state.professionals.find(p => p.id === professionalId);
            if (!professional) return;

            const profileLink = generateProfileLink(professionalId);
            const shareText = `Confira o perfil de ${professional.name} no WeCut!\n${professional.specialty}\n⭐ ${professional.rating} (${professional.reviews} avaliações)\n\n${profileLink}`;

            // Tentar usar Web Share API (mobile)
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: `Perfil de ${professional.name} - WeCut`,
                        text: shareText,
                        url: profileLink
                    });
                    console.log('Compartilhado com sucesso!');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        copyToClipboard(profileLink, professional.name);
                    }
                }
            } else {
                // Fallback: copiar para área de transferência
                copyToClipboard(profileLink, professional.name);
            }
        }

        // Função auxiliar para copiar para clipboard
        function copyToClipboard(text, professionalName) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showShareSuccessMessage(professionalName);
                }).catch(() => {
                    fallbackCopyToClipboard(text, professionalName);
                });
            } else {
                fallbackCopyToClipboard(text, professionalName);
            }
        }

        // Fallback para navegadores antigos
        function fallbackCopyToClipboard(text, professionalName) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showShareSuccessMessage(professionalName);
            } catch (err) {
                alert('Não foi possível copiar. Link: ' + text);
            }

            document.body.removeChild(textArea);
        }

        // Mostrar mensagem de sucesso
        function showShareSuccessMessage(professionalName) {
            // Remove mensagem anterior se existir
            const oldMsg = document.getElementById('share-success-toast');
            if (oldMsg) oldMsg.remove();

            const toast = document.createElement('div');
            toast.id = 'share-success-toast';
            toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #10b981;
        color: white;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 100000;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        animation: slideUp 0.3s ease-out;
    `;

            toast.innerHTML = `
        <i data-lucide="check-circle" class="w-5 h-5"></i>
        <span>Link do perfil copiado! 🎉</span>
    `;

            document.body.appendChild(toast);

            if (window.lucide) lucide.createIcons();

            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Função para verificar se há um profile ID na URL ao carregar a página
        function checkProfileLinkOnLoad() {
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('profile');

            if (profileId) {
                const professionalId = parseInt(profileId);
                const professional = stateManager.state.professionals.find(p => p.id === professionalId);

                if (professional) {
                    // Pequeno delay para garantir que a página carregou
                    setTimeout(() => {
                        showProfessionalDetailsModal(professionalId);
                    }, 500);
                } else {
                    alert('Profissional não encontrado.');
                    // Limpar URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
        }

    </script>
    <div class="hidden md:hidden bg-white border-t border-gray-200" id="mobile-menu">
        <div class="px-4 py-3 space-y-2" id="mobile-menu-content">
            <button
                class="w-full text-left px-3 py-2 rounded-md text-sm font-medium text-black hover:bg-gray-50 wecut-button-hover nav-link"
                data-view="dashboard-page">Dashboard</button>
            <button
                class="w-full text-left px-3 py-2 rounded-md text-sm font-medium text-black hover:bg-gray-50 wecut-button-hover nav-link"
                data-view="professional-view-profile-page">Meu Perfil</button>
            <button
                class="w-full text-left px-3 py-2 rounded-md text-sm font-medium text-black hover:bg-gray-50 wecut-button-hover nav-link"
                data-view="appointments-page">Agendamentos</button>
        </div>
    </div>
    <div id="page-container">
    </div>
    <div class="gap-3 fixed hidden inset-0 z-50 sm:flex-row bg-opacity-50 bg-black flex-col justify-end justify-center items-center flex"
        id="professional-details-modal">
        <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="gap-3 mb-4 sm:flex-row flex-col justify-between justify-end items-center flex">
                <h3 class="text-xl font-bold text-black" id="professional-details-title">Detalhes do Profissional</h3>
                <button class="text-gray-500 hover:text-gray-700" onclick="closeProfessionalDetailsModal()">
                    <i class="w-6 h-6" data-lucide="x"></i>
                </button>
            </div>
            <div class="space-y-4" id="professional-details-content">
            </div>
            <div class="gap-3 sm:flex-row flex-col mt-6 space-x-3 justify-end flex">
                <button
                    class="rounded sm:w-auto py-2 w-full bg-red-600 hover:bg-red-700 text-white wecut-button-hover transition-colors px-4"
                    id="remove-from-details">
                    Remover Profissional
                </button>
                <button
                    class="rounded hover:bg-gray-50 border sm:w-auto py-2 w-full border-gray-300 wecut-button-hover transition-colors px-4"
                    onclick="closeProfessionalDetailsModal()">
                    Fechar
                </button>
            </div>
        </div>
    </div>
    <div class="gap-3 fixed hidden inset-0 z-50 sm:flex-row bg-opacity-50 bg-black flex-col justify-end justify-center items-center flex"
        id="rating-modal">
        <button
            class="rounded hover:bg-gray-50 border sm:w-auto py-2 transition-colors mb-4 w-full border-gray-300 wecut-button-hover text-black items-center flex px-4"
            onclick="history.back()">
            <i class="w-4 h-4 mr-2" data-lucide="arrow-left"></i> Voltar
        </button>
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="gap-3 mb-4 sm:flex-row flex-col justify-between justify-end items-center flex">
                <h3 class="text-xl font-bold text-black">Avaliar Serviço</h3>
                <button class="text-gray-500 hover:text-gray-700" onclick="closeRatingModal()">
                    <i class="w-6 h-6" data-lucide="x"></i>
                </button>
            </div>
            <form id="rating-form" onsubmit="submitRating(event)">
                <input id="rating-appointment-id" type="hidden" />
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-black mb-2">Avaliação</label>
                        <div class="rating-stars text-2xl">
                            <input id="star5" name="rating" type="radio" value="5" />
                            <label for="star5">★</label>
                            <input id="star4" name="rating" type="radio" value="4" />
                            <label for="star4">★</label>
                            <input id="star3" name="rating" type="radio" value="3" />
                            <label for="star3">★</label>
                            <input id="star2" name="rating" type="radio" value="2" />
                            <label aria-label="2 estrelas" for="star2" title="2 estrelas">★</label>
                            <input id="star1" name="rating" type="radio" value="1" />
                            <label for="star1">★</label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-black mb-2">Comentário (opcional)</label>
                        <textarea class="w-full p-3 border border-gray-300 rounded-lg focus:border-black focus:ring-0"
                            id="rating-comment" placeholder="Compartilhe sua experiência..." rows="3"></textarea>
                    </div>
                </div>
                <div class="gap-3 sm:flex-row flex-col mt-6 justify-end flex">
                    <button
                        class="rounded hover:bg-gray-50 border sm:w-auto py-2 w-full border-gray-300 wecut-button-hover transition-colors px-4"
                        onclick="closeRatingModal()" type="button">Cancelar</button>
                    <button
                        class="hover:bg-gray-800 rounded sm:w-auto py-2 w-full bg-black text-white wecut-button-hover transition-colors px-4"
                        type="submit">Enviar Avaliação</button>
                </div>
            </form>
        </div>
    </div>
    <footer class="bg-gray-900 text-white mt-12 pt-16 pb-10 border-t border-indigo-500/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 lg:gap-10">
                <div class="col-span-2 md:col-span-1 space-y-4">
                    <div class="flex items-center text-3xl font-extrabold text-indigo-400">
                        <i class="w-7 h-7 mr-2" data-lucide="scissors"></i>
                        WeCut
                    </div>
                    <p class="text-gray-400 text-sm">Conectando os melhores profissionais de beleza aos clientes mais
                        exigentes, de forma rápida e eficiente.</p>
                    <div class="flex space-x-4 pt-2">
                        <a aria-label="Facebook" class="text-gray-400 hover:text-indigo-400 transition-colors" href="#"
                            target="_blank">
                            <i class="w-5 h-5" data-lucide="facebook"></i>
                        </a>
                        <a aria-label="Instagram" class="text-gray-400 hover:text-indigo-400 transition-colors" href="#"
                            target="_blank">
                            <i class="w-5 h-5" data-lucide="instagram"></i>
                        </a>
                        <a aria-label="LinkedIn" class="text-gray-400 hover:text-indigo-400 transition-colors" href="#"
                            target="_blank">
                            <i class="w-5 h-5" data-lucide="linkedin"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-indigo-300">Navegação</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="search"></i>Buscar Profissional</a></li>
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="user-plus"></i>Cadastre seu Salão</a></li>
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="bookmark"></i>Agendamentos</a></li>
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="help-circle"></i>FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-indigo-300">Empresa</h3>
                    <ul class="space-y-3 text-sm">
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="info"></i>Sobre Nós</a></li>
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="file-text"></i>Termos de Serviço</a></li>
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="shield"></i>Política de Privacidade</a></li>
                        <li><a class="text-gray-400 hover:text-white transition-colors flex items-center" href="#"><i
                                    class="w-4 h-4 mr-2" data-lucide="mail"></i>Contato</a></li>
                    </ul>
                </div>
                <div class="col-span-2 md:col-span-1">
                    <h3 class="text-lg font-semibold mb-4 text-indigo-300">Fale Conosco</h3>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-start text-gray-400">
                            <i class="w-4 h-4 mr-3 mt-1 flex-shrink-0 text-indigo-400" data-lucide="map-pin"></i>
                            Maputo, Matola
                        </li>
                        <li class="flex items-center text-gray-400">
                            <i class="w-4 h-4 mr-3 text-indigo-400" data-lucide="phone"></i>
                            (+258) 84-247-7140/86-896-8059
                        </li>
                        <li class="flex items-center text-gray-400">
                            <i class="w-4 h-4 mr-3 text-indigo-400" data-lucide="mail"></i>
                            wecut005@gmail.com
                        </li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-gray-700 mt-10 pt-6 flex flex-col md:flex-row justify-between items-center text-sm text-gray-500">
                <p class="mb-2 md:mb-0">© <span id="current-year-footer"></span> WeCut. Todos os direitos reservados.
                </p>
                <p class="text-xs">Desenvolvido com <i class="w-3 h-3 inline text-red-500" data-lucide="heart"></i> e
                    dedicação.</p>
            </div>
        </div>
    </footer>
    <script>
        // Define o ano atual no footer e garante que os novos ícones sejam renderizados
        document.getElementById('current-year-footer').textContent = new Date().getFullYear();
        // Re-renderiza os ícones do Lucide para incluir os do footer
        if (typeof lucide !== 'undefined' && lucide.createIcons) {
            lucide.createIcons();
        }
    </script>
</body>

</html>
<script>
    // State Manager
    class StateManager {
        constructor() {
            this.state = {
                currentUser: null,
                users: [],
                professionals: [],
                salons: [],
                appointments: [],
                reviews: [],
                adminTab: 'professionals',
                professionalTab: 'pending',
                bookingProfessionalId: null
            };
        }

        init() {
            const savedState = localStorage.getItem('wecut-state');
            if (savedState) {
                try {
                    const parsedState = JSON.parse(savedState);
                    this.state = { ...this.state, ...parsedState };
                    console.log('Estado restaurado do localStorage');
                } catch (e) {
                    console.error('Erro ao restaurar estado, carregando dados de amostra:', e);
                    this.loadSampleData();
                }
            } else {
                console.log('Nenhum estado salvo, carregando dados de amostra');
                this.loadSampleData();
            }
            this.saveState();
            console.log('Usuários disponíveis:', this.state.users);
        }

        loadSampleData() {
            this.state.users = [
                {
                    id: 1,
                    name: 'Cliente Teste',
                    email: 'client@example.com',
                    type: 'client',
                    password: 'client123'
                },
                {
                    id: 2,
                    name: 'Administrador',
                    email: 'admin@example.com',
                    type: 'admin',
                    password: 'admin123'
                },
                {
                    id: 3,
                    name: 'João Silva',
                    email: 'pro@example.com',
                    type: 'professional',
                    password: 'pro123'
                }
            ];

            this.state.salons = [
                {
                    id: 1,
                    userId: 3,
                    name: 'Barbearia Clássica',
                    location: 'Maputo',
                    phone: '+258 84 123 4567',
                    address: 'Av. Julius Nyerere, 123 - Polana, Maputo',
                    services: ['Corte Masculino', 'Barba'],
                    openingHours: { opening: '09:00', closing: '18:00' },
                    photos: [],
                    submittedAt: new Date().toISOString()
                }
            ];

            this.state.professionals = [
                {
                    id: 1,
                    userId: 3,
                    salonId: 1,
                    name: 'João Silva',
                    specialty: 'Cabelereiro Profissional',
                    description: 'Especialista em cortes masculinos clássicos e contemporâneos',
                    services: [
                        { name: 'Corte Masculino', price: '45,00 MT' },
                        { name: 'Barba', price: '25,00 MT' },
                        { name: 'Corte + Barba', price: '60,00 MT' }
                    ],
                    rating: 4.9,
                    reviews: 128,
                    image: 'https://images.unsplash.com/photo-1562322140-8baeececf3df?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aGFpcmRyZXNzZXJ8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=500&q=60',
                    profileImage: 'https://images.unsplash.com/photo-1562322140-8baeececf3df?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aGFpcmRyZXNzZXJ8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=500&q=60',
                    location: 'Maputo',
                    status: 'approved'
                }
            ];


            this.state.appointments = [
                {
                    id: 1,
                    professionalId: 1,
                    clientName: 'Cliente Teste',
                    service: 'Corte Masculino',
                    date: new Date().toISOString(),
                    time: '14:00',
                    price: '45,00 MT',
                    status: 'pending',
                    code: 'WC001',
                    location: 'Maputo',
                    phone: '+258 84 123 4567',
                    address: 'Av. Julius Nyerere, 123 - Polana, Maputo',
                    image: 'https://images.unsplash.com/photo-1562322140-8baeececf3df?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aGFpcmRyZXNzZXJ8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=500&q=60'
                }
            ];

            this.state.reviews = [];
        }

        setCurrentUser(user) {
            this.state.currentUser = user;
            this.saveState();
        }

        addUser(userData) {
            const newUser = {
                id: Date.now(),
                ...userData
            };
            this.state.users.push(newUser);
            this.saveState();
            return newUser;
        }

        addSalon(salonData) {
            const newSalon = {
                id: Date.now(),
                ...salonData,
                photos: salonData.photos || []
            };
            this.state.salons.push(newSalon);
            this.saveState();
            return newSalon;
        }

        addProfessional(professionalData) {
            const newProfessional = {
                id: Date.now(),
                ...professionalData
            };
            this.state.professionals.push(newProfessional);
            this.saveState();
            return newProfessional;
        }

        addAppointment(appointmentData) {
            const newAppointment = {
                id: Date.now(),
                code: 'WC' + String(this.state.appointments.length + 1).padStart(3, '0'),
                ...appointmentData
            };
            this.state.appointments.push(newAppointment);
            this.saveState();
            return newAppointment;
        }

        addReview(reviewData) {
            const newReview = {
                id: Date.now(),
                ...reviewData,
                createdAt: new Date().toISOString()
            };
            this.state.reviews.push(newReview);

            // Atualizar rating do profissional
            const professionalReviews = this.state.reviews.filter(r => r.professionalId === reviewData.professionalId);
            const totalRating = professionalReviews.reduce((sum, review) => sum + review.rating, 0);
            const averageRating = professionalReviews.length > 0 ? totalRating / professionalReviews.length : 0;

            const professional = this.state.professionals.find(p => p.id === reviewData.professionalId);
            if (professional) {
                professional.rating = parseFloat(averageRating.toFixed(1));
                professional.reviews = professionalReviews.length;
            }

            this.saveState();
            return newReview;
        }

        getApprovedProfessionals() {
            // Filtra por 'status' (admin-approved) E 'isAvailable' (self-managed)
            return this.state.professionals.filter(pro => pro.status === 'approved' && pro.isAvailable === true);
        }

        getProfessionalAppointments(professionalId) {
            return this.state.appointments.filter(apt => apt.professionalId === professionalId);
        }

        getUserAppointments(userId) {
            const user = this.state.users.find(u => u.id === userId);
            if (!user) return [];

            if (user.type === 'client') {
                return this.state.appointments.filter(apt => apt.clientName === user.name);
            }
            return [];
        }

        updateAppointmentStatus(appointmentId, status) {
            const appointment = this.state.appointments.find(apt => apt.id === appointmentId);
            if (appointment) {
                appointment.status = status;
                this.saveState();
                return true;
            }
            return false;
        }

        removeProfessional(professionalId) {
            const index = this.state.professionals.findIndex(p => p.id === professionalId);
            if (index !== -1) {
                this.state.professionals.splice(index, 1);
                this.saveState();
                return true;
            }
            return false;
        }

        setAdminTab(tab) {
            this.state.adminTab = tab;
            this.saveState();
        }

        setProfessionalTab(tab) {
            this.state.professionalTab = tab;
            this.saveState();
        }

        saveState() {
            localStorage.setItem('wecut-state', JSON.stringify(this.state));
        }

        // Método para autenticar usuário
        authenticateUser(email, password) {
            const user = this.state.users.find(u => u.email === email);
            console.log('Tentando autenticar:', email);
            console.log('Usuário encontrado:', user);
            console.log('Senha fornecida:', password);
            console.log('Senha esperada:', user?.password);

            if (user && user.password === password) {
                return user;
            }
            return null;
        }

        // Verificar se email já existe
        userExists(email) {
            return this.state.users.some(user => user.email === email);
        }

        // Método para obter reviews de um profissional
        getProfessionalReviews(professionalId) {
            return this.state.reviews.filter(review => review.professionalId === professionalId);
        }
    }

    const stateManager = new StateManager();

    // Funções de Navegação e UI
    function initNavbarListeners() {
        document.querySelectorAll('.nav-link').forEach(button => {
            button.addEventListener('click', function () {
                const viewName = this.getAttribute('data-view');
                renderView(viewName);
            });
        });

        document.getElementById('logo').addEventListener('click', function () {
            renderView('home-page');
        });

        document.getElementById('login-btn')?.addEventListener('click', function () {
            renderView('login-page');
        });

        document.getElementById('signup-btn')?.addEventListener('click', function () {
            renderView('login-page');
            setTimeout(() => {
                showRegisterForm();
            }, 100);
        });

        document.getElementById('logout-btn')?.addEventListener('click', function () {
            handleLogout();
        });
    }

    function handleLogout() {
        stateManager.setCurrentUser(null);
        renderView('home-page');
        updateAuthUI();
    }

    function updateAuthUI() {
        const authButtons = document.getElementById('auth-buttons');
        const userMenu = document.getElementById('user-menu');

        if (stateManager.state.currentUser) {
            if (authButtons) authButtons.classList.add('hidden');
            if (userMenu) userMenu.classList.remove('hidden');

            const userName = document.getElementById('user-name');
            if (userName) userName.textContent = stateManager.state.currentUser.name;
            updateUserTypeNavigation();
        } else {
            if (authButtons) authButtons.classList.remove('hidden');
            if (userMenu) userMenu.classList.add('hidden');
        }
    }

    function updateUserTypeNavigation() {
        const clientNav = document.getElementById('client-nav');
        const professionalNav = document.getElementById('professional-nav');
        const adminNav = document.getElementById('admin-nav');

        if (clientNav) clientNav.classList.add('hidden');
        if (professionalNav) professionalNav.classList.add('hidden');
        if (adminNav) adminNav.classList.add('hidden');

        if (stateManager.state.currentUser?.type === 'client') {
            if (clientNav) clientNav.classList.remove('hidden');
        } else if (stateManager.state.currentUser?.type === 'professional') {
            if (professionalNav) professionalNav.classList.remove('hidden');
        } else if (stateManager.state.currentUser?.type === 'admin') {
            if (adminNav) adminNav.classList.remove('hidden');
        }
    }

    // Funções de Autenticação
    function handleLogin(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }

        const email = document.getElementById('email')?.value;
        const password = document.getElementById('password')?.value;

        console.log('=== TENTATIVA DE LOGIN ===');
        console.log('Email:', email);
        console.log('Senha:', password);

        if (!email || !password) {
            alert('Por favor, preencha todos os campos');
            return;
        }

        try {
            // Usar o método authenticateUser do stateManager
            const user = stateManager.authenticateUser(email, password);

            console.log('Resultado da autenticação:', user);

            if (user) {
                stateManager.setCurrentUser(user);

                console.log('Tipo de usuário:', user.type);

                // Redirecionamento baseado no tipo de usuário
                if (user.type === 'admin') {
                    console.log('Redirecionando para admin dashboard');
                    renderView('admin-dashboard-page');
                } else if (user.type === 'professional') {
                    console.log('Redirecionando para professional dashboard');
                    renderView('professional-dashboard-page');
                } else {
                    console.log('Redirecionando para search page');
                    renderView('search-page');
                }

                updateAuthUI();
                alert(`Login realizado com sucesso! Bem-vindo(a), ${user.name}`);
            } else {
                console.error('Autenticação falhou');
                alert('E-mail ou senha incorretos');
            }
        } catch (error) {
            console.error('ERRO COMPLETO:', error);
            console.error('Stack trace:', error.stack);
            alert('Erro ao fazer login: ' + error.message);
        }
    }

    async function handleRegister(event) {
        console.log('📝 Processando cadastro...');
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }

        const userType = document.querySelector('input[name="userType"]:checked')?.value;
        const name = document.getElementById('register-name')?.value;
        const email = document.getElementById('register-email')?.value;
        const password = document.getElementById('register-password')?.value;

        if (!name || !email || !password) {
            alert('Por favor, preencha todos os campos obrigatórios');
            return;
        }
        // Validação de senha
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{5,20}$/;
        if (!passwordRegex.test(password)) {
            alert('A senha deve ter entre 5 e 20 caracteres e incluir pelo menos uma letra e um número.');
            return;
        }


        // Verificar se email já existe
        if (stateManager.userExists(email)) {
            alert('Este e-mail já está cadastrado');
            return;
        }

        try {
            const userData = {
                name,
                email,
                password,
                type: userType
            };

            if (userType === 'professional') {
                const salonName = document.getElementById('salon-name')?.value;
                const salonLocation = document.getElementById('salon-location')?.value;
                const salonPhone = document.getElementById('salon-phone')?.value;
                const salonAddress = document.getElementById('salon-address')?.value;
                const professionalDescription = document.getElementById('professional-description')?.value;

                if (!salonName || !salonLocation || !salonPhone || !salonAddress || !professionalDescription) {
                    alert('Por favor, preencha todos os campos obrigatórios do salão');
                    return;
                }

                // Processar foto de perfil
                let profilePhoto = null;
                const profilePhotoInput = document.getElementById('professional-profile-photo');
                if (profilePhotoInput.files && profilePhotoInput.files[0]) {
                    profilePhoto = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.readAsDataURL(profilePhotoInput.files[0]);
                    });
                }

                // Coletar serviços selecionados (não obrigatórios)
                const selectedServices = Array.from(document.querySelectorAll('.service-checkbox:checked'))
                    .map(checkbox => checkbox.value);

                // Coletar serviços personalizados
                const customServices = Array.from(document.querySelectorAll('#custom-services-list > div'))
                    .map(div => div.querySelector('input[type="hidden"]').value);

                const allServices = [...selectedServices, ...customServices];

                // Processar fotos do salão
                const photoInput = document.getElementById('salon-photos');
                let salonPhotos = [];

                if (photoInput.files && photoInput.files.length > 0) {
                    const files = Array.from(photoInput.files).slice(0, 5); // Limitar a 5 fotos

                    // Converter fotos para Data URLs (simulação - em produção enviaria para servidor)
                    for (const file of files) {
                        if (file.type.startsWith('image/')) {
                            const dataUrl = await new Promise((resolve) => {
                                const reader = new FileReader();
                                reader.onload = (e) => resolve(e.target.result);
                                reader.readAsDataURL(file);
                            });
                            salonPhotos.push(dataUrl);
                        }
                    }
                }

                const salonData = {
                    name: salonName,
                    location: salonLocation,
                    phone: salonPhone,
                    address: salonAddress,
                    services: allServices,
                    openingHours: {
                        opening: document.getElementById('opening-time')?.value || '09:00',
                        closing: document.getElementById('closing-time')?.value || '18:00'
                    },
                    photos: salonPhotos,
                    submittedAt: new Date().toISOString()
                };

                const newUser = stateManager.addUser(userData);
                const newSalon = stateManager.addSalon({
                    ...salonData,
                    userId: newUser.id
                });

                stateManager.addProfessional({
                    userId: newUser.id,
                    salonId: newSalon.id,
                    name: userData.name,
                    specialty: allServices[0] || 'Profissional de Beleza',
                    description: professionalDescription,
                    services: allServices,
                    rating: 0,
                    reviews: 0,
                    image: salonPhotos.length > 0 ? salonPhotos[0] : null,  // ← MUDANÇA AQUI
                    profileImage: profilePhoto || null,  // ← MUDANÇA AQUI
                    price: '45,00 MT',
                    location: salonData.location,
                    status: 'approved',
                    isAvailable: true
                });

                stateManager.setCurrentUser(newUser);

                alert('✅ Cadastro realizado com sucesso! Seu perfil profissional já está ativo.');
                renderView('professional-dashboard-page');

            } else {
                const newUser = stateManager.addUser(userData);
                stateManager.setCurrentUser(newUser);
                alert('✅ Cadastro realizado com sucesso!');
                renderView('search-page');
            }

            const registerForm = document.getElementById('register-form');
            if (registerForm) registerForm.reset();

        } catch (error) {
            console.error('Erro no cadastro:', error);
            alert('Erro ao realizar cadastro. Tente novamente.');
        }
    }

    function showRegisterForm() {
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        if (loginForm && registerForm) {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');

            // Atualizar ícones após mostrar o formulário
            if (window.lucide) {
                setTimeout(() => {
                    lucide.createIcons();
                }, 100);
            }
        }
    }

    function showLoginForm() {
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        if (loginForm && registerForm) {
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        }
    }

    // ============================================================================
    // TELA DE VER PERFIL ESPECÍFICA PARA O PROFISSIONAL
    // ============================================================================

    function getProfessionalViewProfileContent() {
        const professional = stateManager.state.professionals.find(p => p.userId === stateManager.state.currentUser?.id);
        const salon = stateManager.state.salons.find(s => s.id === professional.salonId);

        if (!professional || !salon) {
            return '<div class="p-8 text-center text-red-600">Perfil não encontrado</div>';
        }

        return `
    <div class="min-h-screen bg-gray-50 md:heigh ">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Meu Perfil</h1>
                    <p class="text-gray-600">Visualize seus dados cadastrais</p>
                </div>
                <div class="flex gap-3">
                     <button onclick="renderView('professional-dashboard-page')" 
                        class="bg-gray-600 text-white hover:bg-gray-700 px-4 py-2 rounded-lg wecut-button-hover flex items-center">
                        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                        Voltar
                    </button>
                    <button onclick="renderView('professional-edit-profile-page')" 
                        class="bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-lg wecut-button-hover flex items-center">
                        <i data-lucide="edit" class="w-4 h-4 mr-2"></i>
                        Editar Perfil
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-lg border border-gray-300 shadow-sm">
                <div class="p-6 border-b border-gray-300">
                    <div class="flex flex-col sm:flex-row items-start gap-4 sm:gap-6 w-full overflow-hidden">
                        <div class="w-24 h-24 rounded-full overflow-hidden flex-shrink-0 border-2 border-gray-300">
                            <img 
                                src="${professional.profileImage}" 
                                alt="${professional.name}"
                                class="w-full h-full object-cover"
                            />
                        </div>
                        <div class="flex-1 min-w-0">
                            <h2 class="text-2xl font-bold text-gray-900 mb-1">${professional.name}</h2>
                            <p class="text-lg text-gray-600 mb-2">${professional.specialty}</p>
                            <div class="flex items-center gap-4 mb-3">
                                <div class="flex items-center gap-2">
                                    <div class="flex gap-1">
                                        ${Array(5).fill().map((_, i) => `
                                            <i data-lucide="star" class="w-4 h-4 ${i < Math.floor(professional.rating) ? 'fill-yellow-400 stroke-yellow-400' : 'stroke-gray-300'}"></i>
                                        `).join('')}
                                    </div>
                                    <span class="font-medium text-gray-900">${professional.rating}</span>
                                    <span class="text-gray-600">(${professional.reviews} avaliações)</span>
                                </div>
                                <span class="px-3 py-1 rounded-full text-sm ${professional.isAvailable ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${professional.isAvailable ? 'Disponível' : 'Indisponível'}
                                </span>
                            </div>
                            <p class="text-gray-700">${professional.description}</p>
                        </div>
                    </div>
                </div>

                <div class="p-6 border-b border-gray-300">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Informações do Salão</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Salão</label>
                                <p class="text-gray-900">${salon.name}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Localização</label>
                                <p class="text-gray-900">${salon.location}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                <p class="text-gray-900">${salon.phone}</p>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Endereço</label>
                                <p class="text-gray-900">${salon.address}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Horário de Funcionamento</label>
                                <p class="text-gray-900">${salon.openingHours?.opening || '09:00'} - ${salon.openingHours?.closing || '18:00'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Dias de Trabalho</label>
                                <p class="text-gray-900">${professional.workingSchedule?.days?.join(', ') || 'Segunda a Sexta'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-6 border-b border-gray-300">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Serviços Oferecidos</h3>
                    <div class="space-y-3">
                        ${professional.services.map(service => `
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-900">${service.name || service}</span>
                                <span class="text-green-600 font-semibold">${service.price || professional.price}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Galeria do Salão</h3>
                    ${salon.photos && salon.photos.length > 0 ? `
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            ${salon.photos.map(photo => `
                                <div class="aspect-square rounded-lg overflow-hidden border border-gray-300">
                                    <img src="${photo}" alt="Foto do salão" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300" />
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-8 bg-gray-50 rounded-lg">
                            <i data-lucide="camera" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                            <p class="text-gray-600">Nenhuma foto cadastrada</p>
                        </div>
                    `}
                </div>
            </div>

            <!-- Métricas atualizadas -->
            ${getProfessionalMetrics(professional.id)}
        </div>
    </div>
    `;
    }

    function getProfessionalEditProfileContent() {
        const professional = stateManager.state.professionals.find(p => p.userId === stateManager.state.currentUser?.id);
        const salon = stateManager.state.salons.find(s => s.id === professional.salonId);

        if (!professional || !salon) {
            return '<div class="p-8 text-center text-red-600">Erro: Dados de edição não encontrados</div>';
        }

        const availableDays = ['Segunda', 'Terca', 'Quarta', 'Quinta', 'Sexta', 'Sabado', 'Domingo'];

        return `
    <div class="min-h-screen bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Editar Perfil Profissional</h1>
                    <p class="text-gray-600">Atualize seus dados cadastrais</p>
                </div>
                <button onclick="renderView('professional-view-profile-page')" 
                        class="bg-gray-600 text-white hover:bg-gray-700 px-4 py-2 rounded-lg wecut-button-hover flex items-center">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                    Voltar ao Perfil
                </button>
            </div>
            
            <form id="professional-edit-form" onsubmit="handleProfessionalProfileUpdate(event)">
                <div class="bg-white rounded-lg border border-gray-300 shadow-sm p-6 space-y-6">

                    <div class="border-b pb-4">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <i data-lucide="zap" class="w-5 h-5 text-indigo-600"></i> Status da Conta
                        </h3>
                        <div class="flex items-center gap-6">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="account-status" value="available" class="form-radio h-5 w-5 text-green-600" 
                                    ${professional.isAvailable ? 'checked' : ''}>
                                <span class="ml-2 text-gray-700">Disponível</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="account-status" value="unavailable" class="form-radio h-5 w-5 text-red-600"
                                    ${!professional.isAvailable ? 'checked' : ''}>
                                <span class="ml-2 text-gray-700">Indisponível</span>
                            </label>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-b pb-4">
                        <h3 class="md:col-span-2 text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <i data-lucide="user" class="w-5 h-5 text-indigo-600"></i> Informações do Profissional
                        </h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                            <input type="text" id="edit-name" value="${professional.name}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Especialidade</label>
                            <input type="text" id="edit-specialty" value="${professional.specialty}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                            <textarea id="edit-description" rows="3" class="w-full p-2 border border-gray-300 rounded-lg">${professional.description}</textarea>
                        </div>
                    </div>

                    <div class="border-b pb-4">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <i data-lucide="clock" class="w-5 h-5 text-indigo-600"></i> Horário e Intervalo
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                 <label class="block text-sm font-medium text-gray-700 mb-2">Intervalo de Agendamento (minutos)</label>
                                 <input type="number" id="edit-interval" value="${professional.workingSchedule?.interval || 30}" min="10" step="5" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                            <div>
                                 <label class="block text-sm font-medium text-gray-700 mb-2">Horário de Abertura</label>
                                 <input type="time" id="edit-opening-time" value="${salon.openingHours?.opening || '09:00'}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                            <div>
                                 <label class="block text-sm font-medium text-gray-700 mb-2">Horário de Fechamento</label>
                                 <input type="time" id="edit-closing-time" value="${salon.openingHours?.closing || '18:00'}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dias de Funcionamento</label>
                            <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-7 gap-2">
                                ${availableDays.map(day => `
                                    <label class="flex items-center">
                                        <input type="checkbox" name="working-days" value="${day}" class="form-checkbox h-4 w-4 text-black rounded"
                                            ${professional.workingSchedule?.days?.includes(day) ? 'checked' : ''}>
                                        <span class="ml-2 text-sm text-gray-700">${day}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="border-b pb-4">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <i data-lucide="scissors" class="w-5 h-5 text-indigo-600"></i> Serviços e Preços
                        </h3>
                        <div id="services-list" class="space-y-3">
                             ${professional.services.map((service, index) => `
                                <div class="flex gap-2 items-center">
                                    <input type="text" name="service-name" value="${service.name}" placeholder="Nome do Serviço" class="p-2 border border-gray-300 rounded-lg flex-1" required>
                                    <input type="text" name="service-price" value="${service.price}" placeholder="Preço (Ex: 45,00 MT)" class="p-2 border border-gray-300 rounded-lg w-32" required>
                                    <button type="button" onclick="removeServiceInput(this)" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button type="button" onclick="addServiceInput()" class="mt-4 bg-gray-100 text-gray-700 hover:bg-gray-200 px-4 py-2 rounded-lg text-sm flex items-center">
                            <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Adicionar Serviço
                        </button>
                    </div>

                    <div class="border-b pb-4">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
                            <i data-lucide="building" class="w-5 h-5 text-indigo-600"></i> Informações do Salão
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Salão</label>
                                <input type="text" id="edit-salon-name" value="${salon.name}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Localização</label>
                                <input type="text" id="edit-salon-location" value="${salon.location}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                <input type="tel" id="edit-salon-phone" value="${salon.phone}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Endereço Completo</label>
                                <input type="text" id="edit-salon-address" value="${salon.address}" class="w-full p-2 border border-gray-300 rounded-lg" required>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="mt-6 flex justify-end gap-4">
                     <button type="button" onclick="renderView('professional-view-profile-page')" 
                             class="rounded hover:bg-gray-50 border py-2 px-4 border-gray-300 wecut-button-hover transition-colors">
                         Cancelar
                     </button>
                     <button type="submit" class="rounded py-2 px-4 bg-black text-white hover:bg-gray-800 wecut-button-hover transition-colors">
                         Salvar Alterações
                     </button>
                </div>
            </form>
        </div>
    </div>
    `;
    }

    function handleProfessionalProfileUpdate(event) {
        event.preventDefault();

        const professional = stateManager.state.professionals.find(p => p.userId === stateManager.state.currentUser?.id);
        const salon = stateManager.state.salons.find(s => s.id === professional.salonId);

        if (!professional || !salon) {
            alert('Erro ao atualizar perfil.');
            return;
        }

        try {
            // Coletar dados do formulário
            const isAvailable = document.querySelector('input[name="account-status"]:checked').value === 'available';
            const name = document.getElementById('edit-name').value;
            const specialty = document.getElementById('edit-specialty').value;
            const description = document.getElementById('edit-description').value;
            const interval = parseInt(document.getElementById('edit-interval').value);
            const openingTime = document.getElementById('edit-opening-time').value;
            const closingTime = document.getElementById('edit-closing-time').value;

            const workingDays = Array.from(document.querySelectorAll('input[name="working-days"]:checked'))
                .map(checkbox => checkbox.value);

            // Coletar serviços
            const serviceInputs = document.querySelectorAll('#services-list > div');
            const services = Array.from(serviceInputs).map(div => {
                const nameInput = div.querySelector('input[name="service-name"]');
                const priceInput = div.querySelector('input[name="service-price"]');
                return {
                    name: nameInput.value,
                    price: priceInput.value
                };
            });

            // Coletar dados do salão
            const salonName = document.getElementById('edit-salon-name').value;
            const salonLocation = document.getElementById('edit-salon-location').value;
            const salonPhone = document.getElementById('edit-salon-phone').value;
            const salonAddress = document.getElementById('edit-salon-address').value;

            // Atualizar profissional
            professional.name = name;
            professional.specialty = specialty;
            professional.description = description;
            professional.isAvailable = isAvailable;
            professional.workingSchedule = {
                days: workingDays,
                interval: interval
            };
            professional.services = services;

            // Atualizar salão
            salon.name = salonName;
            salon.location = salonLocation;
            salon.phone = salonPhone;
            salon.address = salonAddress;
            salon.openingHours = {
                opening: openingTime,
                closing: closingTime
            };

            // Salvar estado
            stateManager.saveState();

            alert('✅ Perfil atualizado com sucesso!');
            renderView('professional-view-profile-page');

        } catch (error) {
            console.error('Erro ao atualizar perfil:', error);
            alert('❌ Erro ao atualizar perfil. Tente novamente.');
        }
    }

    function addServiceInput() {
        const servicesList = document.getElementById('services-list');
        const newServiceDiv = document.createElement('div');
        newServiceDiv.className = 'flex gap-2 items-center';
        newServiceDiv.innerHTML = `
        <input type="text" name="service-name" placeholder="Nome do Serviço" class="p-2 border border-gray-300 rounded-lg flex-1" required>
        <input type="text" name="service-price" placeholder="Preço (Ex: 45,00 MT)" class="p-2 border border-gray-300 rounded-lg w-32" required>
        <button type="button" onclick="removeServiceInput(this)" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
            <i data-lucide="trash-2" class="w-4 h-4"></i>
        </button>
    `;
        servicesList.appendChild(newServiceDiv);
        if (window.lucide) lucide.createIcons();
    }

    function removeServiceInput(button) {
        button.parentElement.remove();
    }
    // ============================================================================
    // FIM DA TELA DE VER PERFIL DO PROFISSIONAL
    // ============================================================================

    // Funções para download de relatórios
    function downloadProfessionalReport() {
        const professional = stateManager.state.professionals.find(p => p.userId === stateManager.state.currentUser?.id);
        const appointments = stateManager.getProfessionalAppointments(professional?.id);
        const completedAppointments = appointments.filter(apt => apt.status === 'completed');
        let csvContent = "data:text/csv;charset=utf-8,";

        csvContent += "Relatório Completo - WeCut\n\n";
        csvContent += `Profissional: ${professional.name}\n`;
        csvContent += `Data do Relatório: ${new Date().toLocaleDateString('pt-BR')}\n\n`;

        // Estatísticas
        csvContent += "ESTATÍSTICAS\n";
        csvContent += `Total de Serviços Realizados: ${completedAppointments.length}\n`;
        csvContent += `Avaliação Média: ${professional.rating} ⭐\n`;
        csvContent += `Total de Avaliações: ${professional.reviews}\n\n`;

        // Serviços realizados
        csvContent += "SERVIÇOS REALIZADOS\n";
        csvContent += "Data,Cliente,Serviço,Valor,Status\n";
        completedAppointments.forEach(apt => {
            csvContent += `${new Date(apt.date).toLocaleDateString('pt-BR')},${apt.clientName},${apt.service},${apt.price},${apt.status}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `relatorio_wecut_${professional.name}_${new Date().toISOString().split('T')[0]}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert('📊 Relatório baixado com sucesso!');
    }

    function downloadAdminReport() {
        const professionals = stateManager.getApprovedProfessionals();
        const appointments = stateManager.state.appointments;
        let csvContent = "data:text/csv;charset=utf-8,";

        csvContent += "Relatório Administrativo - WeCut\n\n";
        csvContent += `Data do Relatório: ${new Date().toLocaleDateString('pt-BR')}\n`;
        csvContent += `Total de Profissionais: ${professionals.length}\n`;
        csvContent += `Total de Agendamentos: ${appointments.length}\n\n`;

        // Profissionais
        csvContent += "PROFISSIONAIS CADASTRADOS\n";
        csvContent += "Nome,Especialidade,Avaliação,Total Avaliações,Localização\n";
        professionals.forEach(pro => {
            csvContent += `${pro.name},${pro.specialty},${pro.rating},${pro.reviews},${pro.location}\n`;
        });

        csvContent += "\nAGENDAMENTOS\n";
        csvContent += "Código,Cliente,Profissional,Serviço,Data,Status,Valor\n";
        appointments.forEach(apt => {
            const professional = stateManager.state.professionals.find(p => p.id === apt.professionalId);
            csvContent += `${apt.code},${apt.clientName},${professional?.name || 'N/A'},${apt.service},${new Date(apt.date).toLocaleDateString('pt-BR')},${apt.status},${apt.price}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `relatorio_admin_wecut_${new Date().toISOString().split('T')[0]}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert('📊 Relatório administrativo baixado com sucesso!');
    }

    // Função para validar data de agendamento
    function validateBookingDate(date) {
        const selectedDate = new Date(date);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const maxDate = new Date();
        maxDate.setDate(today.getDate() + 10);

        if (selectedDate < today) {
            alert('❌ Não é possível agendar para datas passadas.');
            return false;
        }

        if (selectedDate > maxDate) {
            alert('❌ Não é possível agendar com mais de 10 dias de antecedência.');
            return false;
        }

        return true;
    }

    // Views
    function getHomePageContent() {
        const professionals = stateManager.getApprovedProfessionals();

        return `
            <div class="min-h-screen bg-white">
                <section class="bg-white py-20">
                    <div class="max-w-7xl mx-auto px-4 text-center">
                        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-black mb-6">
                            Encontre o salão perfeito<br>para o seu estilo
                        </h1>
                        <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
                            Descubra os melhores profissionais de beleza perto de você.<br>
                            Agende seu próximo corte com facilidade e segurança.
                        </p>
                        <div class="max-w-4xl mx-auto mb-8">
                            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                                <div class="flex flex-col md:flex-row gap-4">
                                    <div class="flex-1 relative">
                                        <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                                        <input
                                            type="text"
                                            id="search-input"
                                            placeholder="Buscar por profissional ou serviço..."
                                            class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:border-black focus:ring-0"
                                            onkeyup="handleSearchInput(event)"
                                        />
                                    </div>
                                    <div class="flex-shrink-0">
                                        <button
                                            class="w-full md:w-auto bg-black text-white hover:bg-gray-800 px-6 py-3 rounded-lg font-semibold wecut-button-hover flex items-center justify-center gap-2"
                                            onclick="renderView('search-page')"
                                        >
                                            <i data-lucide="search" class="w-5 h-5"></i>
                                            Buscar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

  <section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
            Profissionais em Destaque
        </h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            ${professionals.length > 0 ? professionals.slice(0, 4).map(pro => `
                <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 border border-gray-200 cursor-pointer" onclick="showProfessionalDetailsModal(${pro.id})">
                    <div class="relative h-36 overflow-hidden rounded-t-lg">
                        <img 
                            src="${pro.image}" 
                            alt="${pro.name}" 
                            class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                        />
                        <div class="absolute top-2 right-2 bg-black text-white px-3 py-1 rounded-full text-xs font-semibold">
                            ${pro.location}
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <h3 class="text-xl font-bold text-gray-900 mb-1 truncate">${pro.name}</h3>
                        <p class="text-sm text-gray-600 mb-3">${pro.specialty}</p>
                        
                        <div class="flex items-center gap-2 mb-4">
                            <div class="flex gap-1 text-yellow-500">
                                ${Array(5).fill().map((_, i) => `
                                    <i data-lucide="star" class="w-4 h-4 ${i < Math.floor(pro.rating) ? 'fill-yellow-500 stroke-yellow-500' : 'stroke-gray-300'}"></i>
                                `).join('')}
                            </div>
                            <span class="text-sm font-medium text-gray-700">${pro.rating} (${pro.reviews})</span>
                        </div>
                        
                        <div>
                            <button 
                                class="w-full bg-black text-white hover:bg-gray-800 py-2 rounded-lg font-semibold text-sm wecut-button-hover"
                                onclick="event.stopPropagation(); showProfessionalDetailsModal(${pro.id})"
                            >
                                Ver Perfil
                            </button>
                        </div>
                    </div>
                </div>
            `).join('') : `
                <div class="col-span-full text-center py-10 bg-white rounded-lg border border-gray-200 shadow-md">
                    <i data-lucide="search-x" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                    <p class="text-gray-600">Nenhum profissional encontrado. Tente novamente mais tarde.</p>
                </div>
            `}
        </div>
        
        <div class="text-center mt-12">
            <button onclick="renderView('search-page')" class="bg-black text-white hover:bg-gray-800 px-6 py-3 rounded-lg font-semibold wecut-button-hover">
                Ver Todos os Profissionais
            </button>
        </div>
    </div>
</section>

                <section class="py-20 bg-white">
                    <div class="max-w-7xl mx-auto px-4 text-center">
                        <h2 class="text-3xl font-bold text-gray-900 mb-12">Como Funciona o WeCut</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                            <div class="p-6 rounded-lg">
                                <i data-lucide="search" class="w-12 h-12 text-black mx-auto mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-900 mb-3">1. Encontre</h3>
                                <p class="text-gray-600">Use nossa busca avançada para encontrar o profissional ou salão ideal perto de você.</p>
                            </div>
                            <div class="p-6 rounded-lg">
                                <i data-lucide="calendar-check" class="w-12 h-12 text-black mx-auto mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-900 mb-3">2. Agende</h3>
                                <p class="text-gray-600">Escolha o serviço, data e horário disponíveis com apenas alguns cliques.</p>
                            </div>
                            <div class="p-6 rounded-lg">
                                <i data-lucide="scissors" class="w-12 h-12 text-black mx-auto mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-900 mb-3">3. Transforme</h3>
                                <p class="text-gray-600">Receba seu serviço no salão e sinta a diferença de agendar com o WeCut.</p>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
            `;
    }

    function getSearchPageContent() {
        const professionals = stateManager.getApprovedProfessionals();

        return `
            <div class="min-h-screen bg-gray-50">
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">Buscar Profissionais</h1>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-8">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1 relative">
                                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                                <input
                                    type="text"
                                    id="filter-search-input"
                                    placeholder="Buscar por nome, serviço ou localização..."
                                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-black focus:ring-0"
                                    onkeyup="filterProfessionals()"
                                />
                            </div>
                            <div class="flex-shrink-0 relative">
                                <i data-lucide="map-pin" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                                <select id="filter-location-select" onchange="filterProfessionals()" class="w-full md:w-40 appearance-none pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-black focus:ring-0 bg-white">
                                    <option value="">Localização</option>
                                    <option value="Maputo">Maputo</option>
                                    <option value="Matola">Matola</option>
                                    <option value="Nampula">Nampula</option>
                                </select>
                                <i data-lucide="chevron-down" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                            </div>
                            <div class="flex-shrink-0 relative">
                                <i data-lucide="star" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                                <select id="filter-rating-select" onchange="filterProfessionals()" class="w-full md:w-32 appearance-none pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-black focus:ring-0 bg-white">
                                    <option value="">Avaliação</option>
                                    <option value="4.5">4.5+ estrelas</option>
                                    <option value="4">4+ estrelas</option>
                                    <option value="3">3+ estrelas</option>
                                </select>
                                <i data-lucide="chevron-down" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"></i>
                            </div>
                        </div>
                    </div>

                    <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${professionals.map(pro => `
                            <div class="professional-card bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 border border-gray-200 cursor-pointer" 
                                data-name="${pro.name}" 
                                data-location="${pro.location}" 
                                data-services="${pro.services.join(',')}" 
                                data-rating="${pro.rating}"
                                onclick="showProfessionalDetailsModal(${pro.id})">
                                <div class="relative h-40 overflow-hidden rounded-t-lg">
                                    <img 
                                        src="${pro.image}" 
                                        alt="${pro.name}" 
                                        class="w-full h-full object-cover"
                                    />
                                </div>
                                <div class="p-4">
                                    <h3 class="text-xl font-bold text-gray-900 mb-1 truncate">${pro.name}</h3>
                                    <p class="text-sm text-gray-600 mb-3">${pro.specialty}</p>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex gap-1 text-yellow-500">
                                            ${Array(5).fill().map((_, i) => `
                                                <i data-lucide="star" class="w-4 h-4 ${i < Math.floor(pro.rating) ? 'fill-yellow-500 stroke-yellow-500' : 'stroke-gray-300'}"></i>
                                            `).join('')}
                                        </div>
                                        <span class="text-sm font-medium text-gray-700">${pro.rating} (${pro.reviews})</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-700 mb-4">
                                        <i data-lucide="map-pin" class="w-4 h-4 mr-2 text-red-500"></i>
                                        ${pro.location}
                                    </div>
                                    <button 
                                        class="w-full bg-black text-white hover:bg-gray-800 py-2 rounded-lg font-semibold text-sm wecut-button-hover"
                                    >
                                        Ver Perfil
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="no-results" class="hidden text-center py-10">
                        <i data-lucide="search-x" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                        <p class="text-xl font-semibold text-gray-600">Nenhum profissional corresponde aos filtros.</p>
                        <p class="text-gray-500">Tente ajustar seus termos de busca ou filtros.</p>
                    </div>

                </div>
            </div>
            `;
    }

    function filterProfessionals() {
        const searchText = document.getElementById('filter-search-input')?.value.toLowerCase() || '';
        const location = document.getElementById('filter-location-select')?.value.toLowerCase() || '';
        const minRating = parseFloat(document.getElementById('filter-rating-select')?.value) || 0;
        const cards = document.querySelectorAll('.professional-card');
        let resultsFound = false;

        cards.forEach(card => {
            const name = card.getAttribute('data-name').toLowerCase();
            const cardLocation = card.getAttribute('data-location').toLowerCase();
            const services = card.getAttribute('data-services').toLowerCase();
            const cardRating = parseFloat(card.getAttribute('data-rating'));

            const matchesSearch = name.includes(searchText) || services.includes(searchText);
            const matchesLocation = !location || cardLocation === location;
            const matchesRating = cardRating >= minRating;

            if (matchesSearch && matchesLocation && matchesRating) {
                card.classList.remove('hidden');
                resultsFound = true;
            } else {
                card.classList.add('hidden');
            }
        });

        const noResultsDiv = document.getElementById('no-results');
        if (noResultsDiv) {
            if (resultsFound) {
                noResultsDiv.classList.add('hidden');
            } else {
                noResultsDiv.classList.remove('hidden');
            }
        }
    }

    function getAppointmentsPageContent() {
        if (!stateManager.state.currentUser) {
            return `
                    <div class="p-8 text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Acesso Negado</h2>
                        <p class="text-gray-600 mb-6">Por favor, faça login para ver seus agendamentos.</p>
                        <button onclick="renderView('login-page')" class="bg-black text-white hover:bg-gray-800 px-6 py-3 rounded-lg font-semibold wecut-button-hover">
                            Fazer Login
                        </button>
                    </div>
                `;
        }

        if (stateManager.state.currentUser.type === 'professional') {
            return getProfessionalDashboardContent();
        } else if (stateManager.state.currentUser.type === 'admin') {
            return getAdminDashboardContent();
        }

        const appointments = stateManager.getUserAppointments(stateManager.state.currentUser.id);

        return `
            <div class="min-h-screen bg-gray-50">
                <div class="max-w-4xl mx-auto px-4 py-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-8">Meus Agendamentos</h1>
                    
                    <div class="space-y-6">
                        ${appointments.length > 0 ? appointments.map(apt => {
            const professional = stateManager.state.professionals.find(p => p.id === apt.professionalId);
            const statusClass = apt.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                apt.status === 'confirmed' ? 'bg-blue-100 text-blue-800' :
                    apt.status === 'completed' ? 'bg-green-100 text-green-800' :
                        'bg-red-100 text-red-800';

            const isPast = new Date(apt.date) < new Date(new Date().setHours(0, 0, 0, 0));

            return `
                                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 flex flex-col sm:flex-row gap-4 items-start">
                                    <div class="flex-shrink-0 w-24 h-24 rounded-lg overflow-hidden border border-gray-300">
                                        <img src="${apt.image}" alt="${professional?.name || 'Profissional'}" class="w-full h-full object-cover">
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex justify-between items-start mb-2">
                                            <h3 class="text-xl font-bold text-gray-900 truncate">${apt.service}</h3>
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusClass}">
                                                ${apt.status.charAt(0).toUpperCase() + apt.status.slice(1)}
                                            </span>
                                        </div>
                                        <p class="text-gray-700 mb-1">Com: <span class="font-medium">${professional?.name || 'Profissional Indisponível'}</span></p>
                                        <div class="flex items-center text-sm text-gray-600 mb-1">
                                            <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                            ${new Date(apt.date).toLocaleDateString('pt-BR')} às ${apt.time}
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600 mb-3">
                                            <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                            ${apt.location}
                                        </div>
                                        <p class="text-lg font-semibold text-green-600">Valor: ${apt.price}</p>
                                    </div>
                                    <div class="flex-shrink-0 flex flex-col space-y-2 w-full sm:w-auto">
                                        ${apt.status === 'pending' ? `
                                            <button 
                                                class="w-full bg-red-500 text-white hover:bg-red-600 py-2 rounded-lg font-semibold text-sm wecut-button-hover"
                                                onclick="cancelAppointment(${apt.id})"
                                            >
                                                Cancelar
                                            </button>
                                            <p class="text-xs text-gray-500 text-center">Aguardando confirmação do profissional.</p>
                                        ` : apt.status === 'confirmed' ? `
                                            <p class="text-sm text-center text-blue-600 font-medium py-2 rounded-lg bg-blue-50">
                                                Agendamento Confirmado
                                            </p>
                                        ` : apt.status === 'completed' && !isPast ? `
                                            <p class="text-sm text-center text-green-600 font-medium py-2 rounded-lg bg-green-50">
                                                Serviço Concluído
                                            </p>
                                            <button 
                                                class="w-full bg-yellow-500 text-white hover:bg-yellow-600 py-2 rounded-lg font-semibold text-sm wecut-button-hover"
                                                onclick="showRatingModal(${apt.id})"
                                            >
                                                Avaliar
                                            </button>
                                        ` : `
                                            <p class="text-sm text-center text-gray-600 font-medium py-2 rounded-lg bg-gray-100">
                                                Histórico de Serviço
                                            </p>
                                        `}
                                    </div>
                                </div>
                            `;
        }).join('') : `
                            <div class="text-center py-12 bg-white rounded-lg border border-gray-200 shadow-md">
                                <i data-lucide="calendar-x" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                                <p class="text-xl font-semibold text-gray-600">Nenhum agendamento encontrado.</p>
                                <p class="text-gray-500 mt-2">Que tal encontrar um profissional agora?</p>
                                <button onclick="renderView('search-page')" class="mt-4 bg-black text-white hover:bg-gray-800 px-6 py-3 rounded-lg font-semibold wecut-button-hover">
                                    Buscar Profissional
                                </button>
                            </div>
                        `}
                    </div>
                </div>
            </div>
            `;
    }

    function cancelAppointment(appointmentId) {
        if (confirm('Tem certeza que deseja cancelar este agendamento?')) {
            const success = stateManager.updateAppointmentStatus(appointmentId, 'canceled');
            if (success) {
                alert('Agendamento cancelado com sucesso.');
                renderView('appointments-page');
            } else {
                alert('Erro ao cancelar agendamento.');
            }
        }
    }

    function getProfessionalDashboardContent() {
        const professional = stateManager.state.professionals.find(p => p.userId === stateManager.state.currentUser?.id);
        if (!professional) {
            return '<div class="p-8 text-center text-red-600">Erro: Perfil profissional não encontrado.</div>';
        }

        const allAppointments = stateManager.getProfessionalAppointments(professional.id);
        const tab = stateManager.state.professionalTab;

        const filteredAppointments = allAppointments.filter(apt => {
            if (tab === 'pending') return apt.status === 'pending';
            if (tab === 'confirmed') return apt.status === 'confirmed';
            if (tab === 'completed') return apt.status === 'completed' || apt.status === 'canceled';
            return true;
        }).sort((a, b) => new Date(a.date) - new Date(b.date));

        // Status message baseada na disponibilidade
        const statusMessage = professional.isAvailable ?
            '<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">✅ Seu perfil está ativo e visível para clientes</div>' :
            '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">🔴 Seu perfil está indisponível e não aparece nas buscas</div>';

        return `
    <div class="min-h-screen bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Dashboard Profissional</h1>
            <p class="text-gray-600 mb-8">Gerencie seus agendamentos e perfil.</p>

            ${statusMessage}

            <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-8">
                <div class="flex items-center justify-between flex-wrap gap-4 mb-4">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 rounded-full overflow-hidden border-2 border-black">
                            <img src="${professional.profileImage}" alt="${professional.name}" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">${professional.name}</h2>
                            <p class="text-gray-600">${professional.specialty}</p>
                        </div>
                   
                        <div class="flex gap-3 flex-wrap">
    <button onclick="renderView('professional-view-profile-page')" class="bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-lg text-sm wecut-button-hover flex items-center">
        <i data-lucide="user" class="w-4 h-4 mr-2"></i> Ver Perfil
    </button>
    <button onclick="renderView('professional-edit-profile-page')" class="bg-green-600 text-white hover:bg-green-700 px-4 py-2 rounded-lg text-sm wecut-button-hover flex items-center">
        <i data-lucide="edit" class="w-4 h-4 mr-2"></i> Editar Perfil
    </button>
    <button onclick="shareProfileLink(${professional.id})" class="bg-purple-600 text-white hover:bg-purple-700 px-4 py-2 rounded-lg text-sm wecut-button-hover flex items-center">
        <i data-lucide="share-2" class="w-4 h-4 mr-2"></i> Compartilhar
    </button>
    <button onclick="downloadProfessionalReport()" class="bg-indigo-600 text-white hover:bg-indigo-700 px-4 py-2 rounded-lg text-sm wecut-button-hover flex items-center">
        <i data-lucide="download" class="w-4 h-4 mr-2"></i> Relatório
    </button>
</div>
                    </div>  

                <!-- Métricas atualizadas -->
                ${getProfessionalMetrics(professional.id)}
            </div>

            <!-- Restante do código do dashboard permanece igual -->
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Gerenciamento de Agendamentos</h2>

            <div class="flex border-b border-gray-300 mb-6">
                <button onclick="setProfessionalTabAndRender('pending')" class="px-4 py-2 text-sm font-medium ${tab === 'pending' ? 'border-b-2 border-black text-black' : 'text-gray-500 hover:text-gray-700'}">
                    Pendentes (${allAppointments.filter(a => a.status === 'pending').length})
                </button>
                <button onclick="setProfessionalTabAndRender('confirmed')" class="px-4 py-2 text-sm font-medium ${tab === 'confirmed' ? 'border-b-2 border-black text-black' : 'text-gray-500 hover:text-gray-700'}">
                    Confirmados (${allAppointments.filter(a => a.status === 'confirmed').length})
                </button>
                <button onclick="setProfessionalTabAndRender('completed')" class="px-4 py-2 text-sm font-medium ${tab === 'completed' ? 'border-b-2 border-black text-black' : 'text-gray-500 hover:text-gray-700'}">
                    Histórico
                </button>
            </div>

            <div class="space-y-4">
                ${filteredAppointments.length > 0 ? filteredAppointments.map(apt => {
            const statusClass = apt.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                apt.status === 'confirmed' ? 'bg-blue-100 text-blue-800' :
                    apt.status === 'completed' ? 'bg-green-100 text-green-800' :
                        'bg-red-100 text-red-800';

            return `
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="text-lg font-bold text-gray-900 truncate">${apt.service}</h3>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusClass} md:hidden">
                                        ${apt.status.charAt(0).toUpperCase() + apt.status.slice(1)}
                                    </span>
                                </div>
                                <p class="text-gray-700 text-sm mb-1">Cliente: <span class="font-medium">${apt.clientName}</span></p>
                                <div class="flex items-center text-sm text-gray-600 mb-1">
                                    <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                    ${new Date(apt.date).toLocaleDateString('pt-BR')} às ${apt.time}
                                </div>
                                <p class="text-md font-semibold text-green-600">${apt.price}</p>
                            </div>
                            
                            <div class="flex-shrink-0 flex items-center gap-3">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusClass} hidden md:block">
                                    ${apt.status.charAt(0).toUpperCase() + apt.status.slice(1)}
                                </span>
                                ${apt.status === 'pending' ? `
                                    <button 
                                        class="bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-lg text-sm wecut-button-hover"
                                        onclick="confirmAppointment(${apt.id})"
                                    >
                                        Confirmar
                                    </button>
                                    <button 
                                        class="bg-red-500 text-white hover:bg-red-600 px-4 py-2 rounded-lg text-sm wecut-button-hover"
                                        onclick="cancelAppointment(${apt.id})"
                                    >
                                        Cancelar
                                    </button>
                                ` : apt.status === 'confirmed' ? `
                                    <button 
                                        class="bg-green-600 text-white hover:bg-green-700 px-4 py-2 rounded-lg text-sm wecut-button-hover"
                                        onclick="completeAppointment(${apt.id})"
                                    >
                                        Concluir
                                    </button>
                                    <button 
                                        class="bg-red-500 text-white hover:bg-red-600 px-4 py-2 rounded-lg text-sm wecut-button-hover"
                                        onclick="cancelAppointment(${apt.id})"
                                    >
                                        Cancelar
                                    </button>
                                ` : apt.status === 'completed' ? `
                                    <span class="text-sm text-green-600 font-medium">Concluído</span>
                                ` : apt.status === 'canceled' ? `
                                    <span class="text-sm text-red-600 font-medium">Cancelado</span>
                                ` : ''}
                            </div>
                        </div>
                    `;
        }).join('') : `
                    <div class="text-center py-8 bg-white rounded-lg border border-gray-200">
                        <i data-lucide="inbox" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                        <p class="text-gray-600">Nenhum agendamento ${tab === 'completed' ? 'no histórico' : tab}.</p>
                    </div>
                `}
            </div>
        </div>
    </div>
    `;
    }

    function setProfessionalTabAndRender(tab) {
        stateManager.setProfessionalTab(tab);
        renderView('professional-dashboard-page');
    }

    function confirmAppointment(appointmentId) {
        if (confirm('Deseja realmente confirmar este agendamento?')) {
            const success = stateManager.updateAppointmentStatus(appointmentId, 'confirmed');
            if (success) {
                alert('Agendamento confirmado!');
                renderView('professional-dashboard-page');
            } else {
                alert('Erro ao confirmar agendamento.');
            }
        }
    }

    function completeAppointment(appointmentId) {
        if (confirm('Deseja marcar este agendamento como CONCLUÍDO?')) {
            const success = stateManager.updateAppointmentStatus(appointmentId, 'completed');
            if (success) {
                alert('Agendamento concluído com sucesso!');
                renderView('professional-dashboard-page');
            } else {
                alert('Erro ao concluir agendamento.');
            }
        }
    }

    function getAdminDashboardContent() {
        const tab = stateManager.state.adminTab;
        const professionals = stateManager.state.professionals;
        const appointments = stateManager.state.appointments;
        const users = stateManager.state.users.filter(u => u.type === 'client');

        let content;
        let totalItems;

        if (tab === 'professionals') {
            content = professionals.map(pro => `
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex justify-between items-center gap-4">
                        <div>
                            <h3 class="text-lg font-bold text-gray-900">${pro.name}</h3>
                            <p class="text-sm text-gray-600">${pro.specialty} em ${pro.location}</p>
                            <p class="text-xs text-gray-500">Avaliação: ${pro.rating} (${pro.reviews} aval.)</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="showProfessionalDetailsModal(${pro.id})" class="bg-blue-600 text-white hover:bg-blue-700 px-3 py-1 rounded-lg text-sm wecut-button-hover">
                                Detalhes
                            </button>
                            <button onclick="removeProfessionalFromAdmin(${pro.id})" class="bg-red-600 text-white hover:bg-red-700 px-3 py-1 rounded-lg text-sm wecut-button-hover">
                                Remover
                            </button>
                        </div>
                    </div>
                `).join('');
            totalItems = professionals.length;
        } else if (tab === 'appointments') {
            content = appointments.sort((a, b) => new Date(b.date) - new Date(a.date)).map(apt => {
                const professional = stateManager.state.professionals.find(p => p.id === apt.professionalId);
                const statusClass = apt.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                    apt.status === 'confirmed' ? 'bg-blue-100 text-blue-800' :
                        apt.status === 'completed' ? 'bg-green-100 text-green-800' :
                            'bg-red-100 text-red-800';

                return `
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex justify-between items-center gap-4">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">${apt.service} - ${apt.code}</h3>
                                <p class="text-sm text-gray-600">Com: ${professional?.name || 'N/A'}</p>
                                <p class="text-xs text-gray-500">${new Date(apt.date).toLocaleDateString('pt-BR')} - ${apt.clientName}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusClass}">
                                ${apt.status.charAt(0).toUpperCase() + apt.status.slice(1)}
                            </span>
                        </div>
                    `;
            }).join('');
            totalItems = appointments.length;
        } else if (tab === 'users') {
            content = users.map(user => `
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex justify-between items-center gap-4">
                        <div>
                            <h3 class="text-lg font-bold text-gray-900">${user.name}</h3>
                            <p class="text-sm text-gray-600">${user.email}</p>
                            <p class="text-xs text-gray-500">Tipo: Cliente</p>
                        </div>
                        <span class="text-sm text-gray-500">${stateManager.getUserAppointments(user.id).length} Agendamentos</span>
                    </div>
                `).join('');
            totalItems = users.length;
        }

        return `
            <div class="min-h-screen bg-gray-50">
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">Dashboard Administrador</h1>
                    <p class="text-gray-600 mb-8">Visão geral do sistema WeCut.</p>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                            <p class="text-2xl font-bold text-gray-900">${professionals.length}</p>
                            <p class="text-sm text-gray-600">Profissionais Ativos</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                            <p class="text-2xl font-bold text-gray-900">${appointments.length}</p>
                            <p class="text-sm text-gray-600">Total de Agendamentos</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200 text-center">
                            <p class="text-2xl font-bold text-gray-900">${users.length}</p>
                            <p class="text-sm text-gray-600">Clientes Cadastrados</p>
                        </div>
                        <button onclick="downloadAdminReport()" class="bg-black text-white hover:bg-gray-800 px-4 py-2 rounded-lg text-sm font-semibold wecut-button-hover flex items-center justify-center gap-2">
                            <i data-lucide="download" class="w-5 h-5"></i>
                            Relatório Completo
                        </button>
                    </div>

                    <h2 class="text-2xl font-bold text-gray-900 mb-4">Gerenciar Dados (${totalItems} Itens)</h2>
                    <div class="flex border-b border-gray-300 mb-6">
                        <button onclick="setAdminTabAndRender('professionals')" class="px-4 py-2 text-sm font-medium ${tab === 'professionals' ? 'border-b-2 border-black text-black' : 'text-gray-500 hover:text-gray-700'}">
                            Profissionais
                        </button>
                        <button onclick="setAdminTabAndRender('appointments')" class="px-4 py-2 text-sm font-medium ${tab === 'appointments' ? 'border-b-2 border-black text-black' : 'text-gray-500 hover:text-gray-700'}">
                            Agendamentos
                        </button>
                        <button onclick="setAdminTabAndRender('users')" class="px-4 py-2 text-sm font-medium ${tab === 'users' ? 'border-b-2 border-black text-black' : 'text-gray-500 hover:text-gray-700'}">
                            Clientes
                        </button>
                    </div>

                    <div class="space-y-4">
                        ${content.length > 0 ? content : `
                            <div class="text-center py-8 bg-white rounded-lg border border-gray-200">
                                <i data-lucide="search-x" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                                <p class="text-gray-600">Nenhum dado encontrado para esta seção.</p>
                            </div>
                        `}
                    </div>
                </div>
            </div>
            `;
    }

    function setAdminTabAndRender(tab) {
        stateManager.setAdminTab(tab);
        renderView('admin-dashboard-page');
    }

    function removeProfessionalFromAdmin(professionalId) {
        if (confirm('ATENÇÃO: Deseja realmente remover este profissional? Todos os dados serão perdidos.')) {
            const success = stateManager.removeProfessional(professionalId);
            if (success) {
                alert('Profissional removido com sucesso.');
                renderView('admin-dashboard-page');
            } else {
                alert('Erro ao remover profissional.');
            }
        }
    }


    // Outras Funções de UI/UX
    function showProfessionalDetailsModal(professionalId) {
        const professional = stateManager.state.professionals.find(p => p.id === professionalId);
        const salon = stateManager.state.salons.find(s => s.id === professional.salonId);

        if (!professional || !salon) {
            alert('Profissional não encontrado.');
            return;
        }

        const isUserAdmin = stateManager.state.currentUser?.type === 'admin';
        const isAdminView = document.getElementById('remove-from-details');

        if (isAdminView) {
            isAdminView.onclick = () => removeProfessionalFromDetails(professionalId);
            isAdminView.style.display = isUserAdmin ? 'block' : 'none';
        }

        

        // Conteúdo do Agendamento (Botões)
        const scheduleButton = `
    <div class="space-y-3">
        <button 
            class="w-full bg-black text-white hover:bg-gray-800 py-3 rounded-lg font-semibold wecut-button-hover flex items-center justify-center gap-2"
            onclick="openBookingSection(${professional.id})"
        >
            <i data-lucide="calendar" class="w-5 h-5"></i> Agendar Horário
        </button>
        <button 
            class="w-full bg-blue-600 text-white hover:bg-blue-700 py-3 rounded-lg font-semibold wecut-button-hover flex items-center justify-center gap-2"
            onclick="shareProfileLink(${professional.id})"
        >
            <i data-lucide="share-2" class="w-5 h-5"></i> Compartilhar Perfil
        </button>
    </div>
`;

        // Horário de Funcionamento
        const openingHoursCard = `
        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h4 class="text-lg font-bold text-gray-900 mb-2 flex items-center gap-2">
                <i data-lucide="clock" class="w-5 h-5 text-black"></i> Horário de Funcionamento
            </h4>
            <p class="text-gray-700">${salon.openingHours?.opening || '09:00'} - ${salon.openingHours?.closing || '18:00'}</p>
            <p class="text-sm text-gray-500 mt-1">Horário de Moçambique (CAT)</p>
        </div>
    `;

        // Serviços
        const servicesHtml = professional.services.map(service => `
        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
            <span class="font-medium text-gray-900">${service.name || service}</span>
            <span class="text-green-600 font-semibold">${service.price || '45,00 MT'}</span>
        </div>
    `).join('');

        // Galeria
        const galleryHtml = salon.photos && salon.photos.length > 0 ? `
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            ${salon.photos.map(photo => `
                <div class="aspect-square rounded-lg overflow-hidden border border-gray-300">
                    <img src="${photo}" alt="Foto do salão" class="w-full h-full object-cover" />
                </div>
            `).join('')}
        </div>
    ` : `<div class="text-center py-8 bg-gray-50 rounded-lg"><i data-lucide="camera" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i><p class="text-gray-600">Nenhuma foto cadastrada</p></div>`;

        // Reviews
        const reviews = stateManager.getProfessionalReviews(professionalId);
        const reviewsHtml = reviews.length > 0 ? reviews.map(review => `
        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex items-center mb-2">
                <div class="flex gap-1 text-yellow-500 mr-3">
                    ${Array(5).fill().map((_, i) => `
                        <i data-lucide="star" class="w-4 h-4 ${i < review.rating ? 'fill-yellow-500 stroke-yellow-500' : 'stroke-gray-300'}"></i>
                    `).join('')}
                </div>
                <span class="text-sm font-medium text-gray-900">${review.rating}.0</span>
                <span class="text-xs text-gray-500 ml-auto">${new Date(review.createdAt).toLocaleDateString('pt-BR')}</span>
            </div>
            <p class="text-gray-800 font-medium mb-1">${review.clientName}</p>
            <p class="text-gray-600 text-sm">${review.comment || 'Nenhum comentário.'}</p>
        </div>
    `).join('') : `
        <div class="text-center py-4 bg-gray-50 rounded-lg">
            <p class="text-gray-600">Seja o primeiro a avaliar!</p>
        </div>
    `;

        // Estrutura principal do Modal
        const modalContent = `
        <div class="professional-layout-container">
            <div class="professional-layout">
                <div class="professional-main-content space-y-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">Sobre ${professional.name}</h3>
                        <p class="text-gray-700">${professional.description}</p>
                    </div>

                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Serviços e Preços</h3>
                        <div class="space-y-3">
                            ${servicesHtml}
                        </div>
                    </div>

                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Galeria do Salão (${salon.name})</h3>
                        ${galleryHtml}
                    </div>

                    <div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Avaliações (${professional.reviews})</h3>
                        <div class="space-y-3">
                            ${reviewsHtml}
                        </div>
                    </div>
                </div>

                <div class="professional-sidebar">
                    <div class="sticky-sidebar-card bg-white p-4 rounded-lg shadow-lg border border-gray-200 mb-4">
                        ${scheduleButton}
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-lg border border-gray-200">
                        ${openingHoursCard}
                        <div class="mt-4">
                            <h4 class="text-lg font-bold text-gray-900 mb-2 flex items-center gap-2">
                                <i data-lucide="map-pin" class="w-5 h-5 text-black"></i> Localização
                            </h4>
                            <p class="text-gray-700">${salon.address}</p>
                            <p class="text-sm text-gray-500 mt-1">${salon.location}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

        // Preencher o header do modal
        document.getElementById('professional-details-title').innerHTML = `
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 border-2 border-gray-300">
                <img src="${professional.profileImage}" alt="${professional.name}" class="w-full h-full object-cover"/>
            </div>
            <div>
                <h3 class="text-xl font-bold text-black">${professional.name}</h3>
                <p class="text-sm text-gray-600">${professional.specialty} - ${professional.location}</p>
            </div>
        </div>
    `;

        // Inserir o novo corpo de conteúdo
        document.getElementById('professional-details-content').innerHTML = modalContent;

        // Recriar ícones lucide para o novo conteúdo
        if (window.lucide) lucide.createIcons();

        // Mostrar o modal
        const modalElement = document.getElementById('professional-details-modal');
        modalElement.classList.remove('hidden');
    }

    function removeProfessionalFromDetails(professionalId) {
        closeProfessionalDetailsModal();
        removeProfessionalFromAdmin(professionalId);
    }

    function closeProfessionalDetailsModal() {
        document.getElementById('professional-details-modal').classList.add('hidden');
    }



    function closeRatingModal() {
        document.getElementById('rating-modal').classList.add('hidden');
    }

    function openBookingSection(professionalId) {
        const professional = stateManager.state.professionals.find(p => p.id === professionalId);
        const salon = stateManager.state.salons.find(s => s.id === professional?.salonId);
        if (!professional || !salon) return alert('Profissional não encontrado.');

        // Remove qualquer instância anterior
        const old = document.getElementById('fullscreen-booking');
        if (old) old.remove();

        // Fecha o modal de detalhes do profissional se estiver aberto
        const detailsModal = document.getElementById('professional-details-modal');
        if (detailsModal) detailsModal.classList.add('hidden');

        // **CRÍTICO: Ocultar TUDO que está por trás**
        const navbar = document.getElementById('navigation');
        const pageContainer = document.getElementById('page-container');
        const footer = document.querySelector('footer');

        if (navbar) navbar.style.display = 'none';
        if (pageContainer) pageContainer.style.display = 'none';
        if (footer) footer.style.display = 'none';

        // Remover padding e bloquear scroll do body
        document.body.style.paddingTop = '0';
        document.body.style.overflow = 'hidden';
        document.body.style.position = 'fixed'; // **NOVO: Impede scroll completamente**
        document.body.style.width = '100%';
        document.body.style.height = '100%';

        // Cria seção fullscreen
        const section = document.createElement('div');
        section.id = 'fullscreen-booking';
        section.style.cssText = `
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        background: #ffffff !important;
        z-index: 99999 !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        -webkit-overflow-scrolling: touch !important;
    `;

        // Cabeçalho fixo no topo
        const header = document.createElement('div');
        header.style.cssText = `
        position: sticky;
        top: 0;
        background: #ffffff;
        z-index: 100000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        border-bottom: 2px solid #e5e7eb;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        min-height: 64px;
    `;

        header.innerHTML = `
        <h2 class="text-lg md:text-xl font-semibold text-gray-900">Agendar com ${professional.name}</h2>
        <button id="close-booking" class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100 transition-colors">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>
    `;

        // Conteúdo principal
        const content = document.createElement('div');
        content.style.cssText = `
        padding: 20px;
        padding-bottom: 40px;
        min-height: calc(100vh - 64px);
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 100%;
        margin: 0;
        background: #ffffff;
        box-sizing: border-box;
    `;

        content.innerHTML = `
        <div class="flex-1 w-full" style="background: #ffffff;">
            <div class="mb-8 w-full">
                <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-6">Escolha seu Serviço</h3>
                <div id="services-container" class="space-y-4 w-full">
                    ${professional.services.map(s => `
                        <label class="flex items-center p-4 md:p-6 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-green-500 transition-all duration-200 bg-white shadow-sm w-full">
                            <input type="radio" name="selected-service" value="${s.name}|${s.price}" class="service-radio h-5 w-5 md:h-6 md:w-6 text-green-600 focus:ring-green-500">
                            <div class="ml-3 md:ml-4 flex-1">
                                <span class="text-lg md:text-xl font-semibold text-gray-900 block">${s.name}</span>
                                <span class="text-xl md:text-2xl font-bold text-green-600 block mt-1 md:mt-2">${s.price}</span>
                            </div>
                            <div class="w-5 h-5 md:w-6 md:h-6 rounded-full border-2 border-gray-300 flex items-center justify-center ml-3 md:ml-4">
                                <div class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full bg-green-600 hidden radio-check"></div>
                            </div>
                        </label>
                    `).join('')}
                </div>
            </div>

            <div class="mb-8 w-full">
                <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-6">Data e Horário</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 w-full">
                    <div class="w-full">
                        <label class="block text-base md:text-lg font-medium text-gray-700 mb-2 md:mb-3">Data do Agendamento</label>
                        <input type="date" id="booking-date" class="w-full p-3 md:p-4 text-base md:text-lg border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-0" required>
                    </div>
                    <div class="w-full">
                        <label class="block text-base md:text-lg font-medium text-gray-700 mb-2 md:mb-3">Horário</label>
                        <input type="time" id="booking-time" class="w-full p-3 md:p-4 text-base md:text-lg border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-0" required>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-4 md:p-6 rounded-xl mb-8 border-2 border-gray-100 w-full">
                <h3 class="text-lg md:text-xl font-semibold text-gray-900 mb-3 md:mb-4">📍 Local do Atendimento</h3>
                <div class="space-y-2">
                    <p class="text-base md:text-lg text-gray-800 font-medium">${salon.name}</p>
                    <p class="text-sm md:text-base text-gray-600">${salon.address}</p>
                    <p class="text-sm md:text-base text-gray-600">${salon.location}</p>
                    <p class="text-sm md:text-base text-gray-600 font-medium">${salon.phone}</p>
                    <p class="text-xs md:text-sm text-gray-500 mt-2 md:mt-3">⏰ Horário: ${salon.openingHours?.opening || '08:00'} - ${salon.openingHours?.closing || '20:00'}</p>
                </div>
            </div>
        </div>

        <div class="sticky bottom-0 bg-white pt-4 md:pt-6 pb-6 md:pb-8 border-t-2 border-gray-200 mt-6 md:mt-8 w-full shadow-lg">
            <div id="total-display" class="text-center text-2xl md:text-3xl font-bold text-green-600 mb-4 md:mb-6">Total: 0 MT</div>
            <button id="confirm-booking" class="w-full bg-green-600 text-white hover:bg-green-700 py-4 md:py-5 rounded-xl font-bold text-lg md:text-xl wecut-button-hover transition-all duration-200 transform hover:scale-105 active:scale-95">
                <i data-lucide="calendar-check" class="w-5 h-5 md:w-6 md:h-6 inline mr-2 md:mr-3"></i>
                Confirmar Agendamento
            </button>
        </div>
    `;

        // Função auxiliar para restaurar o estado original
        function closeBooking() {
            section.remove();

            // Restaurar TUDO
            const navbar = document.getElementById('navigation');
            const pageContainer = document.getElementById('page-container');
            const footer = document.querySelector('footer');

            if (navbar) navbar.style.display = '';
            if (pageContainer) pageContainer.style.display = '';
            if (footer) footer.style.display = '';

            document.body.style.paddingTop = 'var(--nav-height)';
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.height = '';
        }

        // Event listener para fechar
        header.querySelector('#close-booking').onclick = closeBooking;

        // Atualizar total e estilo quando serviço for selecionado
        content.querySelectorAll('.service-radio').forEach(radio => {
            radio.addEventListener('change', (e) => {
                content.querySelectorAll('.service-radio').forEach(r => {
                    const label = r.closest('label');
                    label.style.borderColor = '#e5e7eb';
                    label.style.background = '#fff';
                    label.querySelector('.radio-check').classList.add('hidden');
                });

                if (e.target.checked) {
                    const label = e.target.closest('label');
                    label.style.borderColor = '#10b981';
                    label.style.background = '#f0fdf4';
                    label.querySelector('.radio-check').classList.remove('hidden');

                    const price = e.target.value.split('|')[1];
                    content.querySelector('#total-display').textContent = `Total: ${price}`;
                }
            });
        });

        // Confirmação de agendamento
        content.querySelector('#confirm-booking').onclick = () => {
            const selectedService = content.querySelector('input[name="selected-service"]:checked');
            const date = content.querySelector('#booking-date').value;
            const time = content.querySelector('#booking-time').value;

            if (!selectedService) {
                alert('Por favor, selecione um serviço.');
                return;
            }

            if (!date || !time) {
                alert('Por favor, selecione data e horário.');
                return;
            }

            const [service, price] = selectedService.value.split('|');

            const conflict = stateManager.state.appointments.some(a =>
                a.professionalId === professionalId &&
                a.date === date &&
                a.time === time
            );

            if (conflict) {
                alert('❌ Este horário já está ocupado. Por favor, escolha outro.');
                return;
            }

            stateManager.addAppointment({
                professionalId,
                clientName: stateManager.state.currentUser?.name || 'Cliente',
                service: service,
                date: date,
                time: time,
                price: price,
                status: 'pending',
                location: salon.location,
                phone: salon.phone,
                address: salon.address,
                image: professional.image
            });

            alert('✅ Agendamento criado com sucesso!');
            closeBooking();
            renderView('search-page');
        };

        section.appendChild(header);
        section.appendChild(content);
        document.body.appendChild(section);

        if (window.lucide) {
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }
    }

    function showRatingModal(appointmentId) {
        document.getElementById('rating-appointment-id').value = appointmentId;
        document.getElementById('rating-modal').classList.remove('hidden');

        // Resetar formulário
        document.getElementById('rating-form').reset();
        const stars = document.querySelectorAll('.rating-stars input');
        stars.forEach(star => star.checked = false);

        if (window.lucide) lucide.createIcons();
    }

    function submitRating(event) {
        event.preventDefault();
        const appointmentId = parseInt(document.getElementById('rating-appointment-id').value);
        const rating = parseInt(document.querySelector('input[name="rating"]:checked')?.value);
        const comment = document.getElementById('rating-comment').value;

        if (!rating) {
            alert('Por favor, selecione uma avaliação de 1 a 5 estrelas.');
            return;
        }

        const appointment = stateManager.state.appointments.find(a => a.id === appointmentId);
        if (!appointment) {
            alert('Erro: Agendamento não encontrado.');
            return;
        }

        const clientName = stateManager.state.currentUser?.name || 'Cliente Anônimo';

        const reviewData = {
            professionalId: appointment.professionalId,
            appointmentId: appointmentId,
            clientName: clientName,
            rating: rating,
            comment: comment
        };

        stateManager.addReview(reviewData);
        alert('✅ Avaliação enviada com sucesso!');
        closeRatingModal();
        renderView('appointments-page');
    }


    function generateTimeSlots(open, close, interval) {
        let slots = '';
        let currentTime = new Date();
        currentTime.setHours(parseInt(open.split(':')[0]), parseInt(open.split(':')[1]), 0, 0);

        let closingTime = new Date();
        closingTime.setHours(parseInt(close.split(':')[0]), parseInt(close.split(':')[1]), 0, 0);

        while (currentTime <= closingTime) {
            const timeString = currentTime.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', hour12: false });
            slots += `<option value="${timeString}">${timeString}</option>`;

            // Adiciona o intervalo (em minutos)
            currentTime.setMinutes(currentTime.getMinutes() + interval);

            // Prevenir loop infinito se o cálculo de data for exato no limite
            if (currentTime.getHours() > closingTime.getHours() || (currentTime.getHours() === closingTime.getHours() && currentTime.getMinutes() > closingTime.getMinutes())) {
                break;
            }
        }
        return slots;
    }


    function handleBooking(event) {
        event.preventDefault();
        const professionalId = stateManager.state.bookingProfessionalId;
        const professional = stateManager.state.professionals.find(p => p.id === professionalId);
        const salon = stateManager.state.salons.find(s => s.id === professional?.salonId);
        const currentUser = stateManager.state.currentUser;

        const serviceValue = document.querySelector('input[name="selectedService"]:checked')?.value;
        const date = document.getElementById('booking-date')?.value;
        const time = document.getElementById('booking-time')?.value;

        if (!serviceValue) {
            alert('Por favor, selecione um serviço.');
            return;
        }

        if (!validateBookingDate(date)) {
            return;
        }

        const [service, price] = serviceValue.split('|');

        const newAppointment = stateManager.addAppointment({
            professionalId: professionalId,
            clientName: currentUser.name,
            service: service,
            date: date,
            time: time,
            price: price,
            status: 'pending',
            location: salon.location,
            phone: salon.phone,
            address: salon.address,
            image: professional.image
        });

        alert(`✅ Agendamento realizado com sucesso! Código: ${newAppointment.code}. Aguardando confirmação do profissional.`);
        renderView('appointments-page');
    }


    // ============================================================================
    // FUNÇÃO PRINCIPAL DE RENDERIZAÇÃO
    // ============================================================================

    function renderView(viewName) {
        console.log('🔄 Renderizando view:', viewName);
        const container = document.getElementById('page-container');
        if (!container) return;

        const viewsMap = {
            'home-page': getHomePageContent,
            'search-page': getSearchPageContent,
            'appointments-page': getAppointmentsPageContent,
            'login-page': getLoginPageContent,
            'admin-dashboard-page': getAdminDashboardContent,
            'professional-dashboard-page': getProfessionalDashboardContent,
            'professional-view-profile-page': getProfessionalViewProfileContent,
            'professional-edit-profile-page': getProfessionalEditProfileContent, // NOVA VIEW
        };
        const contentFunction = viewsMap[viewName];

        if (contentFunction) {
            container.innerHTML = contentFunction();
        } else {
            container.innerHTML = `<div class="p-8 text-center text-red-600">Página não encontrada: ${viewName}</div>`;
        }

        // Recriar ícones lucide para o novo conteúdo
        if (window.lucide) {
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }
    }

    function getLoginPageContent() {
        return `
            <div class="min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
                <div class="max-w-md w-full space-y-8 bg-white p-10 rounded-xl shadow-2xl border border-gray-200">
                    <div>
                        <h2 class="mt-6 text-center text-3xl font-bold text-gray-900">
                            Bem-vindo ao WeCut
                        </h2>
                    </div>

                    <form class="mt-8 space-y-6" id="login-form" onsubmit="handleLogin(event)">
                        <div class="rounded-md shadow-sm -space-y-px">
                            <div>
                                <label for="email" class="sr-only">Endereço de E-mail</label>
                                <input id="email" name="email" type="email" autocomplete="email" required
                                    class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-black focus:border-black sm:text-sm"
                                    placeholder="Endereço de E-mail" value="client@example.com">
                            </div>
                            <div>
                                <label for="password" class="sr-only">Senha</label>
                                <input id="password" name="password" type="password" autocomplete="current-password" required
                                    class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-black focus:border-black sm:text-sm"
                                    placeholder="Senha" value="client123">
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="text-sm">
                                <a href="#" class="font-medium text-black hover:text-gray-700">
                                    Esqueceu sua senha?
                                </a>
                            </div>
                        </div>

                        <div>
                            <button type="submit"
                                class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black wecut-button-hover">
                                Entrar
                            </button>
                        </div>
                        <div class="text-center">
                            <button type="button" onclick="showRegisterForm()" class="text-sm font-medium text-black hover:text-gray-700 underline">
                                Não tem uma conta? Cadastre-se
                            </button>
                        </div>
                    </form>

                    <form class="mt-8 space-y-6 hidden" id="register-form" onsubmit="handleRegister(event)">
                        <div class="text-center">
                            <button type="button" onclick="showLoginForm()" class="text-sm font-medium text-black hover:text-gray-700 underline">
                                Já tem uma conta? Fazer Login
                            </button>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-4 text-center">Criar uma Conta</h3>
                        
                        <div class="rounded-md shadow-sm border border-gray-300 p-4 space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="userType" value="client" checked class="h-4 w-4 text-black border-gray-300 focus:ring-black" onchange="toggleProfessionalFields()">
                                <span class="ml-3 text-sm font-medium text-gray-700">Sou um Cliente</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="userType" value="professional" class="h-4 w-4 text-black border-gray-300 focus:ring-black" onchange="toggleProfessionalFields()">
                                <span class="ml-3 text-sm font-medium text-gray-700">Sou um Profissional/Salão</span>
                            </label>
                        </div>

                        <div class="rounded-md shadow-sm -space-y-px">
                            <input id="register-name" type="text" placeholder="Nome Completo" required
                                class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-black focus:border-black sm:text-sm">
                            <input id="register-email" type="email" placeholder="Endereço de E-mail" required
                                class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-black focus:border-black sm:text-sm">
                            <input id="register-password" type="password" placeholder="Senha (Min 5 carac., letra e número)" required
                                class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-black focus:border-black sm:text-sm">
                        </div>

                        <div id="professional-fields" class="space-y-4 hidden">
                            <h4 class="text-md font-bold text-gray-900 pt-2 border-t border-gray-200">Informações do Salão</h4>

                            <input id="salon-name" type="text" placeholder="Nome do Salão/Barbearia" 
                                class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm">
                            
                            <input id="salon-location" type="text" placeholder="Localização (Ex: Maputo, Matola)" 
                                class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm">

                            <input id="salon-phone" type="tel" placeholder="Telefone de Contacto (Ex: +258 84...)" 
                                class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm">

                            <input id="salon-address" type="text" placeholder="Endereço Completo (Rua, Bairro, Nº)" 
                                class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm">
                            
                            <textarea id="professional-description" placeholder="Descreva sua experiência e especialidade (Cortes, Barba, etc.)" rows="3"
                                class="appearance-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-black focus:border-black sm:text-sm"></textarea>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Serviços Oferecidos (Seleção Rápida)</label>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-full text-sm">
                                        <input type="checkbox" value="Corte Masculino" class="service-checkbox h-4 w-4 text-black border-gray-300 focus:ring-black">
                                        <span class="ml-2">Corte Masculino</span>
                                    </label>
                                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-full text-sm">
                                        <input type="checkbox" value="Barba" class="service-checkbox h-4 w-4 text-black border-gray-300 focus:ring-black">
                                        <span class="ml-2">Barba</span>
                                    </label>
                                    <label class="flex items-center bg-gray-100 px-3 py-2 rounded-full text-sm">
                                        <input type="checkbox" value="Corte + Barba" class="service-checkbox h-4 w-4 text-black border-gray-300 focus:ring-black">
                                        <span class="ml-2">Corte + Barba</span>
                                    </label>
                                </div>
                                
                                <div class="mt-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Adicionar Serviço Personalizado</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="custom-service-input" placeholder="Ex: Tranças Africanas (45,00 MT)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:border-black focus:ring-0 text-sm">
                                        <button type="button" onclick="addCustomService()" class="bg-gray-600 text-white hover:bg-gray-700 px-4 py-2 rounded-md text-sm">Adicionar</button>
                                    </div>
                                    <div id="custom-services-list" class="mt-2 space-y-1">
                                        </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="opening-time" class="block text-sm font-medium text-gray-700 mb-1">Abertura (HH:MM)</label>
                                    <input type="time" id="opening-time" value="09:00" class="w-full px-3 py-3 border border-gray-300 rounded-md focus:border-black focus:ring-0">
                                </div>
                                <div>
                                    <label for="closing-time" class="block text-sm font-medium text-gray-700 mb-1">Fecho (HH:MM)</label>
                                    <input type="time" id="closing-time" value="18:00" class="w-full px-3 py-3 border border-gray-300 rounded-md focus:border-black focus:ring-0">
                                </div>
                            </div>
                            
                            <div class="pt-2 border-t border-gray-200 space-y-3">
                                <div>
                                    <label for="professional-profile-photo" class="block text-sm font-medium text-gray-700 mb-1">Foto de Perfil do Profissional</label>
                                    <input type="file" id="professional-profile-photo" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-50 file:text-black hover:file:bg-gray-100">
                                </div>
                                <div>
                                    <label for="salon-photos" class="block text-sm font-medium text-gray-700 mb-1">Fotos do Salão (Max. 5)</label>
                                    <input type="file" id="salon-photos" accept="image/*" multiple class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-50 file:text-black hover:file:bg-gray-100">
                                </div>
                            </div>
                        </div>

                        <div>
                            <button type="submit"
                                class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black wecut-button-hover">
                                Cadastrar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            `;
    }

    function addCustomService() {
        const input = document.getElementById('custom-service-input');
        const list = document.getElementById('custom-services-list');
        const serviceText = input.value.trim();

        if (serviceText) {
            const serviceNameMatch = serviceText.match(/^([^(]+)/);
            const serviceName = (serviceNameMatch ? serviceNameMatch[1].trim() : serviceText).replace('|', '/');
            const servicePriceMatch = serviceText.match(/\(([^)]+)\)/);
            const servicePrice = servicePriceMatch ? servicePriceMatch[1].trim() : '45,00 MT';

            // Formato final para storage: "Nome do Serviço|Preço"
            const serviceValue = `${serviceName}|${servicePrice}`;

            const div = document.createElement('div');
            div.className = 'flex items-center justify-between p-2 bg-gray-100 rounded-md';
            div.innerHTML = `
                    <span class="text-sm text-gray-700">${serviceName} (${servicePrice})</span>
                    <input type="hidden" value="${serviceValue}">
                    <button type="button" class="text-red-500 hover:text-red-700" onclick="removeCustomService(this)">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                `;
            list.appendChild(div);
            input.value = '';

            if (window.lucide) lucide.createIcons();
        }
    }

    function removeCustomService(button) {
        button.parentElement.remove();
    }


    function toggleProfessionalFields() {
        const userType = document.querySelector('input[name="userType"]:checked')?.value;
        const fields = document.getElementById('professional-fields');

        if (fields) {
            if (userType === 'professional') {
                fields.classList.remove('hidden');
                // Campos obrigatórios para profissional
                document.getElementById('salon-name').setAttribute('required', 'required');
                document.getElementById('salon-location').setAttribute('required', 'required');
                document.getElementById('salon-phone').setAttribute('required', 'required');
                document.getElementById('salon-address').setAttribute('required', 'required');
                document.getElementById('professional-description').setAttribute('required', 'required');
            } else {
                fields.classList.add('hidden');
                // Remover atributo required para cliente
                document.getElementById('salon-name').removeAttribute('required');
                document.getElementById('salon-location').removeAttribute('required');
                document.getElementById('salon-phone').removeAttribute('required');
                document.getElementById('salon-address').removeAttribute('required');
                document.getElementById('professional-description').removeAttribute('required');
            }
        }
    }

    // Inicialização: carrega o estado e renderiza a view inicial
    document.addEventListener('DOMContentLoaded', () => {
        stateManager.init();
        initNavbarListeners();
        updateAuthUI();

        // Lógica de roteamento simples baseada no URL ou estado
        const initialView = stateManager.state.currentUser ?
            (stateManager.state.currentUser.type === 'admin' ? 'admin-dashboard-page' :
                stateManager.state.currentUser.type === 'professional' ? 'professional-dashboard-page' :
                    'search-page') :
            'home-page';

        // Renderiza a view inicial ou a view de busca
        renderView(initialView);
    });


    // === BLOQUEIO DE AVALIAÇÃO DUPLICADA ===
    function canRateOncePerService(clientName, professionalId, serviceName) {
        const previousRatings = stateManager.state.reviews.filter(r =>
            r.clientName === clientName &&
            r.professionalId === professionalId &&
            r.serviceName === serviceName
        );
        return previousRatings.length === 0;
    }

    // Substituir submitRating para verificar a condição
    const oldSubmitRating = window.submitRating;
    window.submitRating = function (event) {
        event.preventDefault();
        const clientName = stateManager.state.currentUser?.name;
        const appointmentId = document.getElementById('rating-appointment-id').value;
        const appointment = stateManager.state.appointments.find(a => a.id == appointmentId);
        if (!appointment) return alert('Erro: agendamento não encontrado.');

        const { professionalId, service } = appointment;
        if (!canRateOncePerService(clientName, professionalId, service)) {
            alert('Você já avaliou este profissional para este serviço.');
            return;
        }

        // Se não houver avaliabnções duplicadas, executa o original
        if (typeof oldSubmitRating === 'function') {
            oldSubmitRating(event);
        }
    };
</script>